{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/1005/","result":{"data":{"site":{"siteMetadata":{"title":"Wan.log","siteUrl":"https://wwan13.github.io","thumbnail":"/thumbnails/tech-blog-thumbnail.png"}},"markdownRemark":{"id":"1e797773-bf47-50cf-84c8-2851a914348d","tableOfContents":"<ul>\n<li><a href=\"#%EC%97%AC%EC%A0%84%ED%9E%88-%EB%B3%B5%EC%9E%A1%ED%95%98%EA%B3%A0-%EA%B7%80%EC%B0%AE%EC%9D%80-%EC%84%A4%EC%A0%95\">여전히 복잡하고 귀찮은 설정</a></li>\n<li><a href=\"#spring-auto-configuration\">Spring Auto Configuration</a></li>\n<li><a href=\"#enablewebsecurity\">@EnableWebSecurity</a></li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></li>\n</ul>","excerpt":"이 포스팅은 이전 포스팅과 동일한 예제를 사용합니다. Spring Security 없이 JWT 인증/인가 구현 해보기 spring filter를 interceptor로 바꿔보자 지난 포스팅에서 를 이용해 다음 세 가지 문제 중 1,…","html":"<blockquote>\n<p>이 포스팅은 이전 포스팅과 동일한 예제를 사용합니다.</p>\n<ol>\n<li><a href=\"https://tech-blog.taewan.co.kr/web-security-without-sprint-security/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Security 없이 JWT 인증/인가 구현 해보기</a></li>\n<li><a href=\"https://tech-blog.taewan.co.kr/spring-filter-and-interceptor/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">spring filter를 interceptor로 바꿔보자</a></li>\n</ol>\n</blockquote>\n<br/>\n<p><a href=\"https://tech-blog.taewan.co.kr/spring-filter-and-interceptor/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">지난 포스팅</a>에서 <code class=\"language-text\">Spring Interceptor</code>를 이용해 다음 세 가지 문제 중 1, 2번 문제를 해결할 수 있었습니다.</p>\n<ol>\n<li><del>발생하는 예외를 핸들링하기 위해 추가적으로 요구되는 <code class=\"language-text\">FilterExceptionHandler</code></del></li>\n<li><del>404 Not Found 를 발생하지 못하고 항상 401 Unauthorized 만을 발생시킴</del></li>\n<li>여전히 복잡하고 귀찮은 설정</li>\n</ol>\n<p>하지만 여전히 복잡한 설정 문제는 해결하지 못하였고, 이번 포스팅을 통해 남아있는 문제를 해결해 보도록 하겠습니다.</p>\n<p><br/><br/></p>\n<h2 id=\"여전히-복잡하고-귀찮은-설정\" style=\"position:relative;\">여전히 복잡하고 귀찮은 설정<a href=\"#%EC%97%AC%EC%A0%84%ED%9E%88-%EB%B3%B5%EC%9E%A1%ED%95%98%EA%B3%A0-%EA%B7%80%EC%B0%AE%EC%9D%80-%EC%84%A4%EC%A0%95\" aria-label=\"여전히 복잡하고 귀찮은 설정 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>저의 security 모듈을 사용하기 위해선 다음 두 가지 인터셉터를 스프링 컨텍스트에 등록한 후, 각 요청에 대한 권한 설정을 모두 해주어야 합니다.</p>\n<p>아래 코드는 기존에 사용하던 설정 클래스로 Security 모듈을 사용하는 모든 Application 모듈이 다음과 같은 설정을 가져야만 했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityInterceptorRegistrar</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">DecodeTokenInterceptor</span> decodeTokenInterceptor<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AuthenticationInterceptor</span> authenticationInterceptor<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addInterceptors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InterceptorRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptor</span><span class=\"token punctuation\">(</span>decodeTokenInterceptor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptor</span><span class=\"token punctuation\">(</span>authenticationInterceptor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppSecurityConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthorizedRequest</span> <span class=\"token function\">authorizedRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">AuthorizedRequestBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withPatterns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token function\">allHttpMethods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/docs/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/login\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup/email\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">GET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/role\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">elseRequestAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>아래 <code class=\"language-text\">AuthorizedRequest</code>를 빈으로 등록하는 과정은 모듈마다 관리해야하는 요청이 상이하기 때문에 모듈마다 별도로 관리하는 것이 당연합니다.<br>\n하지만 위 두 <code class=\"language-text\">Interceptor</code>를 등록하는 과정은 모든 모듈이 정확히 동일한 코드를 사용하게 되어 굉장히 비효율적이라고 느꼈습니다.</p>\n<p><br/><br/></p>\n<h2 id=\"spring-auto-configuration\" style=\"position:relative;\">Spring Auto Configuration<a href=\"#spring-auto-configuration\" aria-label=\"spring auto configuration permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이 문제를 해결하고자 한 순간 Jpa에서 사용하는 <code class=\"language-text\">@EnableJpaRepository</code>라는 어노테이션이 떠올랐습니다.</p>\n<p><code class=\"language-text\">Spring Auto Confiruation</code>은 <strong>일반적으로 많이 사용하는 수많은 빈을 자동으로 등록</strong>해주기 위한 스프링의 대표적인 기능입니다.<br>\nconfiguration클래스 위에 어노테이션을 추가하는 것 만으로 빈 등록을 자동으로 해주는데, 이때 이 어노테이션의 일반적인 네이밍이 <code class=\"language-text\">@Enable***</code>인 것입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b423f4131f7c775a6289f62bd5e35446/f4fb1/spring-boot-application.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.78481012658228%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAxklEQVR42o2Qy3KFIBBE/R0QFS7DyytKzP9/0wnqJlkklcWp7ukauqYY1tXxeWrax5u9nWxbI4aCuMCyWLTWjOP4b4ZcLO3QlKwxZsJME1Nnnpc+mz8em18Ks6Numvc6kpImJ8UyK5RS93VK6Vsfr376b/Od6atwfQr3qqi7p9ZCTAnrhBDmjsdLQELoeSb4eHP5K7809X0JEbGGIXhH8oa2zbT11f8wchyBdiaOKpTUF2Pi5eUp7P4iptI1IyJksVjrmMzIF82InTq9r/a7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"@SpringBootApplication\"\n        title=\"@SpringBootApplication\"\n        src=\"/static/b423f4131f7c775a6289f62bd5e35446/f058b/spring-boot-application.png\"\n        srcset=\"/static/b423f4131f7c775a6289f62bd5e35446/c26ae/spring-boot-application.png 158w,\n/static/b423f4131f7c775a6289f62bd5e35446/6bdcf/spring-boot-application.png 315w,\n/static/b423f4131f7c775a6289f62bd5e35446/f058b/spring-boot-application.png 630w,\n/static/b423f4131f7c775a6289f62bd5e35446/40601/spring-boot-application.png 945w,\n/static/b423f4131f7c775a6289f62bd5e35446/78612/spring-boot-application.png 1260w,\n/static/b423f4131f7c775a6289f62bd5e35446/f4fb1/spring-boot-application.png 1766w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>@SpringBootApplication을 살펴보면 <code class=\"language-text\">@EnableAutoConfiguration</code>이 있는 것을 확인할 수 있는데, 이 어노테이션으로 인해 다양한 빈을 추가적인 설정 없이 사용할 수 있는 것입니다.</p>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aa74a2e89bc16852b9216eaec6578744/b04e4/enable-auto-configuration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.708860759493675%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABEElEQVR42nWRW3KEIBBFZzvh5YyCqDQ0jtn/lm5aJK+a5OOWLVUejrdvfl7w8DP8HMDFoLIC5RGZD5S6I5eKlAuWsGGNBK01nHUtxpj2/jO3EFdMIWLyHu/HCdTIpMDsBXgIjEENylgTIc4btpBBC+NxH6GUegWO/gI+9wvIRaNk3Q1+5y+rf4F7vWBZYOuq5GMFe8b2yHwafUb3KAGpF2A4DS+zTGJaHYiswJ1cYnucgKU725/GttkY6dVc9l9AHwIO+eWd35CSF+COUjIKs3RZpUcC7wX1eMrCipyxLCxjow1pEoF4hxuGb+A4eXCwoElhWyLq7FC8Bo0GaTVip7q9nKVzVq2ac45Rtj7cWw0fn97gnxgsDGEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"@EnableAutoConfiguration\"\n        title=\"@EnableAutoConfiguration\"\n        src=\"/static/aa74a2e89bc16852b9216eaec6578744/f058b/enable-auto-configuration.png\"\n        srcset=\"/static/aa74a2e89bc16852b9216eaec6578744/c26ae/enable-auto-configuration.png 158w,\n/static/aa74a2e89bc16852b9216eaec6578744/6bdcf/enable-auto-configuration.png 315w,\n/static/aa74a2e89bc16852b9216eaec6578744/f058b/enable-auto-configuration.png 630w,\n/static/aa74a2e89bc16852b9216eaec6578744/b04e4/enable-auto-configuration.png 888w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>여기서 @EnableAutoConfiguration은 <code class=\"language-text\">@Import</code>를 통해 <code class=\"language-text\">AutoConfigurationImportSelector.class</code>를 임포트 하고 있어 그 안에 정의된 설정 내용을 그대로 적용시켜 줍니다.</p>\n<p><br/><br/></p>\n<h2 id=\"enablewebsecurity\" style=\"position:relative;\">@EnableWebSecurity<a href=\"#enablewebsecurity\" aria-label=\"enablewebsecurity permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>저는 위에서 본 것과 같이 귀찮고 반복되는 두 인터셉터의 등록 과정을 @EnableWebSecurity라는 Auto Configurer를 정의하는 것으로 보다 간편하게 만들 수 있었습니다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityInterceptorRegistrar</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">DecodeTokenInterceptor</span> decodeTokenInterceptor<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AuthenticationInterceptor</span> authenticationInterceptor<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addInterceptors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InterceptorRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptor</span><span class=\"token punctuation\">(</span>decodeTokenInterceptor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptor</span><span class=\"token punctuation\">(</span>authenticationInterceptor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>우선 각 Application 모듈에 위치한 인터셉터 Registrar 클래스를 Security모듈로 옮겨주었습니다.<br>\n또한 원치 않는 상황에 스프링이 Registrar를 빈으로 등록하는 것을 방지하기 위해 @Configuration 어노테이션을 제거해 주었습니다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RUNTIME</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TYPE</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Import</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token class-name\">SecurityInterceptorRegistrar</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">EnableWebSecurity</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">@EnableWebSecurity</code>를 정의한 뒤 Security모듈로 옮긴 SecurityInterceptorRegistrar를 임포트 해주었습니다.</p>\n<br/>\n<p>각 Application 모듈에서는 다음과 같이 @EnableWebSecurity만으로 간단하게 설정을 마칠 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableWebSecurity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppSecurityConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthorizedRequest</span> <span class=\"token function\">authorizedRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">AuthorizedRequestBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withPatterns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token function\">allHttpMethods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/docs/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/login\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup/email\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">GET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/role\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">elseRequestAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<br/>\n<h2 id=\"마치며\" style=\"position:relative;\">마치며<a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이전 코드와 비교하여 눈에 띄게 간결하진 설정 클래스와, 사라진 반복작업을 확인할 수 있습니다.</p>\n<p>하지만 AuthenticationInterceptor가 AuthorizedRequest의 의존하는 구조이기 때문에 개발자가 신경 써서 AuthorizedRequest를 빈으로 등록해 주지 않는다면 <code class=\"language-text\">BeanCreationException</code>이 발생하게 됩니다.</p>\n<p>또한 모듈에서 Security 모듈 의존성을 가지지만 @EnableWebSecurity를 사용하지 않는 모듈에서도 각 인러셉터들은 @Component애 의해 자동으로 스캔되어 빈으로 등록됩니다. 이처럼 사용하지 않는 빈을 IOC에 가지고 있는 것은 불필요한 리소스의 낭비입니다.</p>\n<p>다음 포스팅에서는 AuthorizedRequest의 빈 등록을 강제하고, 불필요한 빈 생성으로 인해 발생하는 리소스 낭비를 해결하는 방법을 공유해 보겠습니다.</p>","fields":{"slug":"/1005/"},"frontmatter":{"title":"복잡한 Spring Configuration을 더욱 쉽게 관리 하기. (1)","date":"2024-05-11T00:00:00.000Z","description":"Spring Auto Configuration을 알아보고 적용 해보자.","tags":["Tech"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#d8e8c8","images":{"fallback":{"src":"/static/b1a5307f7df81807583d49e95d914791/8058b/thumbnail.png","srcSet":"/static/b1a5307f7df81807583d49e95d914791/52057/thumbnail.png 240w,\n/static/b1a5307f7df81807583d49e95d914791/b380a/thumbnail.png 480w,\n/static/b1a5307f7df81807583d49e95d914791/8058b/thumbnail.png 960w","sizes":"(min-width: 960px) 960px, 100vw"},"sources":[{"srcSet":"/static/b1a5307f7df81807583d49e95d914791/226ed/thumbnail.webp 240w,\n/static/b1a5307f7df81807583d49e95d914791/a1501/thumbnail.webp 480w,\n/static/b1a5307f7df81807583d49e95d914791/55375/thumbnail.webp 960w","type":"image/webp","sizes":"(min-width: 960px) 960px, 100vw"}]},"width":960,"height":720}}}}},"previous":{"fields":{"slug":"/1004/"},"frontmatter":{"title":"spring filter를 interceptor로 바꿔보기."}},"next":{"fields":{"slug":"/1006/"},"frontmatter":{"title":"복잡한 Spring Configuration을 더욱 쉽게 관리하기. (2)"}}},"pageContext":{"id":"1e797773-bf47-50cf-84c8-2851a914348d","previousPostId":"e246245a-f266-57b8-8148-0b1a768f3d4b","nextPostId":"5fd8da91-f0b7-5a05-a814-12a35a47fb3e"}},"staticQueryHashes":["2260143708","2538111481","658623446","984448874"],"slicesMap":{}}