{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/1008/","result":{"data":{"site":{"siteMetadata":{"title":"Wan.log","siteUrl":"https://wwan13.github.io","thumbnail":"/thumbnails/tech-blog-thumbnail.png"}},"markdownRemark":{"id":"5647f79b-95c6-5bc1-b0b2-da126dcac053","tableOfContents":"<ul>\n<li>\n<p><a href=\"#swagger-%EA%B7%B8%EB%A6%AC%EA%B3%A0-spring-rest-docs\">Swagger 그리고 Spring Rest Docs</a></p>\n</li>\n<li>\n<p><a href=\"#openapi-specification-30-oas3\">OpenApi Specification 3.0 (OAS3)</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B5%AC%ED%98%84\">구현</a></p>\n</li>\n<li>\n<p><a href=\"#api-docs-%EC%A0%80%EC%9E%A5%EC%86%8C-%EC%85%8B%EC%97%85\">api-docs 저장소 셋업</a></p>\n<ul>\n<li><a href=\"#indexhtml\">index.html</a></li>\n<li><a href=\"#meta-datajson\">meta-data.json</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#oas3-%EC%B6%94%EC%B6%9C-issus-%EC%83%9D%EC%84%B1\">OAS3 추출, Issus 생성</a></p>\n<ul>\n<li><a href=\"#export_oaspy\">export_oas.py</a></li>\n<li><a href=\"#docsyml\">docs.yml</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#api-docs-%EC%A0%80%EC%9E%A5%EC%86%8C-%EC%B5%9C%EC%8B%A0%ED%99%94\">api-docs 저장소 최신화</a></p>\n<ul>\n<li><a href=\"#update_swaggerpy\">update_swagger.py</a></li>\n<li><a href=\"#update_api_docsyml\">update_api_docs.yml</a></li>\n</ul>\n</li>\n</ul>","excerpt":"API 문서는 개발된 백앤드 API를 프론트앤드 개발자애개 전달하기 위해 필수적입니다. 이때 문서를 직접 쓰며 발생하는 많은 비용을 줄이기 위해  혹은 를 이용해 API…","html":"<p>API 문서는 개발된 백앤드 API를 프론트앤드 개발자애개 전달하기 위해 필수적입니다.<br>\n이때 문서를 직접 쓰며 발생하는 많은 비용을 줄이기 위해 <code class=\"language-text\">Swagger</code> 혹은 <code class=\"language-text\">Spring Rest Docs</code>를 이용해 API 문서를 제작하곤 합니다.<br>\n하지만 이 두 라이브러리들은 각각의 장, 단점이 존재합니다. 이번 시간엔 제가 느낀 각 라이브러리들의 불편한 점과, 이를 해결하고 배포 자동화 시스템을 구축한 과정을 공유해 보려고 합니다.</p>\n<br/>\n<h2 id=\"swagger-그리고-spring-rest-docs\" style=\"position:relative;\">Swagger 그리고 Spring Rest Docs<a href=\"#swagger-%EA%B7%B8%EB%A6%AC%EA%B3%A0-spring-rest-docs\" aria-label=\"swagger 그리고 spring rest docs permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Swagger와 Spring Rest Docs 모두 API 문서를 제작하기 위한 도구입니다.</p>\n<p>Swagger는 간단한 설정과, 어노테이션 만으로 문서를 보다 손쉽게 문서 제작을 할 수 있으며, 아래 Spring Rest Docs에 비해 깔끔한 UI를 제공합니다.<br>\nSpring Rest Docs는 테스트코드를 기반으로 API 문서를 제작하여 운영코드에 침투하지 않고, 테스트를 기반으로 하기 때문에 보다 신뢰도 높은 문서를 제작할 수 있다는 장점이 있습니다.</p>\n<br/>\n<p>하지만 이 두 라이브러리 모두 사용하면서 느꼈던 치명적인 단점이 존재하였습니다.</p>\n<p><strong>Swagger</strong></p>\n<ul>\n<li>더욱 자세한 정보를 제공하려면 운영 코드(Controller, DTO 등)에 swagger와 관련된 어노테이션이 다수 추가된다.</li>\n</ul>\n<p><strong>Spring Rest Docs</strong></p>\n<ul>\n<li>매번 생성된 Snippet을 조합하는 과정이 필요하다.</li>\n<li>프로잭트에 많은 양의 html(api 문서)파일이 포함되어 그 크기가 비대해진다.</li>\n<li>문서의 가독성이 swagger에 비해 떨어진다.</li>\n</ul>\n<br/>\n<p>따라서 저는 다음과 같은 조건을 가지는 API 문서 제작 도구가 필요하였습니다.</p>\n<ul>\n<li>API 문서 관련 코드가 운영 코드에 침투하지 않아야 함.</li>\n<li>매번 Snippet을 조합하는 과정이 자동화되어야 함, 혹은 없어야 함.</li>\n<li>프로젝트에 html 파일이 포함되면 안 됨.</li>\n<li>Swagger에 준하는 가독성을 가져야 함.</li>\n</ul>\n<br/>\n<h2 id=\"openapi-specification-30-oas3\" style=\"position:relative;\">OpenApi Specification 3.0 (OAS3)<a href=\"#openapi-specification-30-oas3\" aria-label=\"openapi specification 30 oas3 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>OAS3은 REST API의 스펙을 yml과 json의 형태로 정의한 것으로 오늘날 사실상 표준으로서 사용되고 있습니다.<br>\nAPI 스펙이 정의된 .yml/.json 파일은 Swagger-Ui를 이용해 이를 시각화할 수 있습니다.</p>\n<p>이에 대한 자세한 예시는 아래 에디터를 통해 확인할 수 있습니다.<br>\n<a href=\"https://editor.swagger.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://editor.swagger.io/</a></p>\n<br/>\n<p>Spring에서는 플러그인과 gradle 명령어를 이용해 Spring Rest Docs로 작성한 테스트를 OAS3 스펙에 맞는 형태로 추출할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// build.gradle.kts</span>\nplugins <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"com.epages.restdocs-api-spec\"</span></span><span class=\"token punctuation\">)</span> version <span class=\"token string-literal singleline\"><span class=\"token string\">\"0.16.0\"</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 <code class=\"language-text\">restdocs-api-spec</code> 플러그인을 추가해 주면 아래 사진처럼 Tasks/documentation 에 문서 추출을 위한 각종 task가 추가된 것을 확인할 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 378px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8afe985f3cd440af5b6ec2ec055340aa/f0991/oas-commands.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACkklEQVR42o1VaXeaUBT0t1QjgmwCBsWFiGuM2iTWJbhHG5O25zT9/x+m794Ga3ti5MPIQx/D3DvzrolsNguCrhswDQ2GYUCWZUiShEwmA0VREO2Jg4RtOygUCuje9NG5+4pGu4f1aoPV6hHTaQjTzDGpqqqMs4R/NqnIOw5MbwDVcOBXq7i6ClCt+rxJktKsmhQTaH2SkD4iBYau4PLyEkG9CU3cW5Yl7l34/hUcJ49yuQLPK8G27fOEOVFaXpD5vo/W/Tc0eyFef75it3vGcrnGfL7CZrNj9HqDk71NHN9QOaRMN2xRlsrGSBkJFxcpJqBSCR8Z9VdhLgfXdVGp+BjcL9Bs9zEcfsFk8iCuY5ECPZbjB4WapvFDeceGG0zhlrvotNtot69Rq9UPDxCpopxW+g8hIZezUPYK0LIyGxXlkfJJv1OMTNNkYzRNF3u00yWTo0EQYPDwC0FnhP3THuFsgfF4iu32CbPZUuRzg5eXHwjDBRvmeWV+YZTRxHEpVIauC6VWCZqZhyVeQi8idcf7jlX+H/bEe42VRZAd28Ld3RD1eoN7GAQNdDrXGAxuhSrv4PiHsTkQyooIsoNutyvQw2g0EU6P2PGZaEGr1XkzRI1HGIFI6Uo5TKWSAikkk5/YqLOxiUA9oSYXix4WixWXSKoeH594YBB2u318wmNicp0MIfJCochnO1qn0+n4hNQfephMKBaL7CadIiKiIVEqVXgaxSYk92hQDEdjXHdvuMztdi8GxJKHw/Pzdx4Q783HkyWTSsMwRT9pOFy8GZLkNV2pz7FNkeUMXDHFH8I5+v3PnMfJJBSnY47b23th1pp7eXxCzvaQTgIN1lotQLPZQqPRFGjxdzfi74LO/HvD4TeVe6PzqMAwugAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"oas3-commands\"\n        title=\"oas3-commands\"\n        src=\"/static/8afe985f3cd440af5b6ec2ec055340aa/f0991/oas-commands.png\"\n        srcset=\"/static/8afe985f3cd440af5b6ec2ec055340aa/c26ae/oas-commands.png 158w,\n/static/8afe985f3cd440af5b6ec2ec055340aa/6bdcf/oas-commands.png 315w,\n/static/8afe985f3cd440af5b6ec2ec055340aa/f0991/oas-commands.png 378w\"\n        sizes=\"(max-width: 378px) 100vw, 378px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이후 별도의 설정 없이 <code class=\"language-text\">openapi3</code> task를 실행하면 다음과 같이 build/api-spec 아래에 <code class=\"language-text\">openapi3.json</code> 파일이 생성된 것을 확인할 수 있습니다.</p>\n<blockquote>\n<p><code class=\"language-text\">$ gradle openapi3</code> 명령어로도 동일한 동작을 수행할 수 있습니다.</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 486px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c62bbc148e78dd0a3cae4d21a6814064/4ee7f/oas3-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.24050632911392%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVR42o2R21KDMBRF+RRbrdwpl9JCgEBgoEC5KI7+/59sTxgfHB+Eh5VkJsk6OyeKH1yQFwJ1/4W8umNePlHVLYZ5QfuYoOk6DNPcjeKfTUShixsrIYTAvRZg8RV1U6IUHI6pwrX13SipdwAPTqhiHcNVxXjTMKUWlsxGdTkh84+0/7yS+dsocuDBC/JQRUPCLtIwkLBlJgoSMveAmJDzbqEkoQsiMlCTaI4NjImFKXMwEkvhYeYO+K+LfEsoySmRCF/R0bN7ZmAgWU2JO1o3kb6mTL3jWnxdbwkl8hBzn1AwC4/3iqQ23viZ+mrjg5IuuUvJbUrtoqTissC/whU6lFM/s9RAS58lBS2llC3oYhN9Qvz0+G/Kb/czAXp/N2GkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"oas3-result\"\n        title=\"oas3-result\"\n        src=\"/static/c62bbc148e78dd0a3cae4d21a6814064/4ee7f/oas3-result.png\"\n        srcset=\"/static/c62bbc148e78dd0a3cae4d21a6814064/c26ae/oas3-result.png 158w,\n/static/c62bbc148e78dd0a3cae4d21a6814064/6bdcf/oas3-result.png 315w,\n/static/c62bbc148e78dd0a3cae4d21a6814064/4ee7f/oas3-result.png 486w\"\n        sizes=\"(max-width: 486px) 100vw, 486px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>openapi3.json 파일 내부에는 우리가 Spring Rest Docs를 이용해 작성한 정보가 OAS3 스펙에 맞는 형식으로 추출되어 있는 것을 볼 수 있습니다.</p>\n<details>\n<summary>ex) openapi3.json</summary>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"openapi\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"3.0.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"info\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"title\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"API documentation\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"version\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.1-SNAPSHOT\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"servers\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"url\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost\"</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"tags\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"paths\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"/api/v1/auth/login\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"post\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"tags\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"auth\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"summary\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"로그인 API\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"operationId\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"login\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"requestBody\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"content\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"application/json;charset=utf-8\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token property\">\"schema\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"$ref\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"#/components/schemas/api-v1-auth-login-1089546234\"</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n              <span class=\"token property\">\"examples\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"login\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                  <span class=\"token property\">\"value\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"{\\\"username\\\":\\\"username\\\",\\\"password\\\":\\\"password\\\"}\"</span>\n                <span class=\"token punctuation\">}</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"responses\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"200\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"description\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"200\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"content\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token property\">\"application/json\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"schema\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                  <span class=\"token property\">\"$ref\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"#/components/schemas/api-v1-auth-login638935618\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"examples\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                  <span class=\"token property\">\"login\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"value\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"{\\\"status\\\":\\\"SUCCESS\\\",\\\"data\\\":{\\\"accessToken\\\":\\\"access token\\\",\\\"refreshToken\\\":\\\"refresh token\\\"},\\\"timestamp\\\":\\\"2024-08-02 15:56:42\\\"}\"</span>\n                  <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"components\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"schemas\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"api-v1-auth-login-1089546234\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"properties\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"password\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"description\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"유저 비밀번호\"</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"username\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"description\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"유저 아이디\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"api-v1-auth-login638935618\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"properties\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"data\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"properties\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token property\">\"accessToken\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"description\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"인증 토큰\"</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n              <span class=\"token property\">\"refreshToken\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token property\">\"description\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"재발급 토큰\"</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"description\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"응답 데이터\"</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"timestamp\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"description\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"응답 시간\"</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"status\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"type\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"description\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"응답 상태\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</details>\n<br/>\n<p>build.gradle.kts 에서 문서 제목, 설명, 서버 등 각종 기본 정보를 설정할 수 있지만 그 범위가 제한되고,<br>\nkotlin dsl 환경에선 두 개 이상의 서버 설정이 어렵기 때문에 여기선 설정하지 않고 이후에 다른 방법으로 메타 정보를 설정하겠습니다.</p>\n<br/>\n<h2 id=\"구현\" style=\"position:relative;\">구현<a href=\"#%EA%B5%AC%ED%98%84\" aria-label=\"구현 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>지금까지 간단한 명령어 만으로 테스트로 작성한 API의 정보를 OAS3 스펙을 만족하는 json 파일을 추출하는 방법을 알아보았습니다.</p>\n<p>이제 추출된 json 파일을 이용해 API 문서를 제작하고 배포하는 과정을 알아보겠습니다.</p>\n<p>우선 이 방법을 사용하려면 다음과 같이 api-docs만을 관리하는 별도의 저장소를 생성해 주어야 합니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fa971564f7f41966e224701af0e274ee/4c42d/repositories.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8UlEQVR42p1QXW+DMBDj///AbdUkVkqnlkJIQkI+CMM7R1qfpj0s0inS3dlnu7l0F5yl2vYDMSV83gYYs+C/rzm1Hfr+ivswYNYG0zTDeY/Feez7Lj2LlDJyztByaN+/EGLEugasISLGhCA/dyuhdhHer9hKqQqTAElgF4dtK/UIwTlvQmiRN/4Gj3GCsUudj5OqmEo4K4VRhiTjghPy395xHM/6a968nzq8vL7Bi4r+esOkdFVBpYWqxVIRO7RJW+ytIdQ+VSURQnfPDL0tkperICokgNaolFaVHEhygBYJZDz3YYSWbLmnZg0nef8QfgOtTtGJMVJZcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"repositories image\"\n        title=\"repositories image\"\n        src=\"/static/fa971564f7f41966e224701af0e274ee/f058b/repositories.png\"\n        srcset=\"/static/fa971564f7f41966e224701af0e274ee/c26ae/repositories.png 158w,\n/static/fa971564f7f41966e224701af0e274ee/6bdcf/repositories.png 315w,\n/static/fa971564f7f41966e224701af0e274ee/f058b/repositories.png 630w,\n/static/fa971564f7f41966e224701af0e274ee/4c42d/repositories.png 896w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<br/>\n<p>구현은 다음과 같은 방법으로 진행됩니다.</p>\n<ol>\n<li>server 저장소의 docs 브랜치로 merge될 때 openapi3.json을 추출한다.</li>\n<li>추출된 openapi3.json 에 포함된 모든 내용을 담아 api-docs 저장소로 issue를 생성한다.</li>\n<li>api-docs 저장소에서 issue 생성이 감지되면 사전 정의된 meta-data와 통합한 swagger.json 파일을 생성한다.</li>\n<li>api-docs 저장소의 내용을 github-pages를 통해 호스팅 한다.</li>\n</ol>\n<br/>\n<h2 id=\"api-docs-저장소-셋업\" style=\"position:relative;\">api-docs 저장소 셋업<a href=\"#api-docs-%EC%A0%80%EC%9E%A5%EC%86%8C-%EC%85%8B%EC%97%85\" aria-label=\"api docs 저장소 셋업 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>앞서 말씀드린 내용과 같이 Swagger 에서는 Swagger-Ui 를 이용해 OAS3 스펙의 파일을 시각화하는 기능을 제공하고 있습니다.</p>\n<h3 id=\"indexhtml\" style=\"position:relative;\">index.html<a href=\"#indexhtml\" aria-label=\"indexhtml permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://unpkg.com/swagger-ui-dist@3/swagger-ui-bundle.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://unpkg.com/swagger-ui-dist@3/swagger-ui.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Grida Diary API Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>swagger-ui<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n            window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> ui <span class=\"token operator\">=</span> <span class=\"token function\">SwaggerUIBundle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">\"swagger.json\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">dom_id</span><span class=\"token operator\">:</span> <span class=\"token string\">'#swagger-ui'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">deepLinking</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                        SwaggerUIBundle<span class=\"token punctuation\">.</span>presets<span class=\"token punctuation\">.</span>apis<span class=\"token punctuation\">,</span>\n                        SwaggerUIBundle<span class=\"token punctuation\">.</span>SwaggerUIStandalonePreset\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                        SwaggerUIBundle<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span>DownloadUrl\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                window<span class=\"token punctuation\">.</span>ui <span class=\"token operator\">=</span> ui\n            <span class=\"token punctuation\">}</span>\n        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>다음과 같이 단순한 html 파일에 swagger.json의 url만 잘 설정해 준다면 간단하게 시각화 기능을 사용할 수 있습니다.</p>\n<blockquote>\n<p>이때 github-pages의 정적 호스팅 서비스를 이용하려면 파일 이름을 반드시 index.html로 설정해 주어야 합니다.</p>\n</blockquote>\n<br/>\n<h3 id=\"meta-datajson\" style=\"position:relative;\">meta-data.json<a href=\"#meta-datajson\" aria-label=\"meta datajson permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"info\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Grida Core API\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0-SNAPSHOT\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"servers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:8080\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"local server\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://liveserver.com\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"live server\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"authorize\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"enable\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"securitySchemes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"bearerAuth\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"scheme\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"bearer\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"bearerFormat\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"JWT\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"security\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"bearerAuth\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>앞에서 설정하지 않았던 meta-data 설정을 이곳에서 해줍니다.<br>\n이 설정은 Swagger에서 기본으로 제공하는 기능이 아니며, 추후에 python 스크립트를 통해 해당 내용을 추가해 줄 예정입니다.</p>\n<br/>\n<h2 id=\"oas3-추출-issus-생성\" style=\"position:relative;\">OAS3 추출, Issus 생성<a href=\"#oas3-%EC%B6%94%EC%B6%9C-issus-%EC%83%9D%EC%84%B1\" aria-label=\"oas3 추출 issus 생성 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>먼저 server 저장소의 docs 브랜치로 merge 될 때 openapi3.json을 추출하고, 그 내용울 담은 Issue를 생성해 주는 작업을 해야 합니다.<br>\nshell, python 등의 선택지가 있었으나 python에 대한 이해도가 그나마 높기 때문에 python을 선택하였습니다.</p>\n<blockquote>\n<p>기능 동작에 초점을 두고 작성한 코드로, 코드의 품질이 좋지 않을 수 있습니다.</p>\n</blockquote>\n<br/>\n<h3 id=\"export_oaspy\" style=\"position:relative;\">export_oas.py<a href=\"#export_oaspy\" aria-label=\"export_oaspy permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>openapi3.json 생성, issue 생성을 담당하는 python 스크립트입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">import</span> time\n\n<span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"no system arguments\"</span><span class=\"token punctuation\">)</span>\n    exit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nGH_TOKEN <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># 시스템 변수로 주입 Github Token 주입</span>\n\nGH_API_BASED_HEADERS <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\"># Github Api 기본 헤더</span>\n    <span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bearer {}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>GH_TOKEN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"X-GitHub-Api-Version\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2022-11-28\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Accept\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"application/vnd.github+json\"</span>\n<span class=\"token punctuation\">}</span>\n\nos<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">(</span><span class=\"token string\">\"gradle :grida-core:core-api:clean\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 스프링 프로젝트(모듈) clean</span>\nos<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">(</span><span class=\"token string\">\"gradle :grida-core:core-api:openapi3\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># openapi3.json 생성</span>\n \n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./grida-core/core-api/build/api-spec/openapi3.json\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> oas<span class=\"token punctuation\">:</span> \n    json_data <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span>oas<span class=\"token punctuation\">)</span> <span class=\"token comment\"># openapi3.json 읽기</span>\n\n    create_issue_endpoint <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.github.com/repos/grida-diary/api-docs/issues\"</span>\n\n    body <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"update api docs \"</span> <span class=\"token operator\">+</span> time<span class=\"token punctuation\">.</span>strftime<span class=\"token punctuation\">(</span><span class=\"token string\">'%Y-%m-%d %H:%M:%S'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"body\"</span><span class=\"token punctuation\">:</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>json_data<span class=\"token punctuation\">,</span> ensure_ascii<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> indent<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span> <span class=\"token comment\"># api-docs 저장소로 issue 생성</span>\n        create_issue_endpoint<span class=\"token punctuation\">,</span>\n        headers<span class=\"token operator\">=</span>GH_API_BASED_HEADERS<span class=\"token punctuation\">,</span>\n        data<span class=\"token operator\">=</span>json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<h3 id=\"docsyml\" style=\"position:relative;\">docs.yml<a href=\"#docsyml\" aria-label=\"docsyml permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>docs 브랜치 병합 시 동작하는 github actions 입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Docs\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"docs\"</span> <span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">export-oas</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> setup java\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>java@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">distribution</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'corretto'</span>\n          <span class=\"token key atrule\">java-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'17'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Python 3.10\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>python@v5\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">python-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.10\"</span>\n          <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'pip'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> pip install requests\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> python3 ./scripts/export_oas.py $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GH_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>겉으로 보기엔 python만 실행하는 것으로 보일 수 있지만, python 스크립트 내에서 gradle 명령어를 호출하기 때문에 python, java 모두 셋업 해주어야 합니다.</p>\n<p>이 과정을 거치면 다음과 같이 api-docs 저장소에 issue가 생성되는 것을 확인할 수 있습니다.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/00e38d41c5d5b3c7ac1af83457b8da3a/3707e/issue.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.291139240506325%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABOklEQVR42qWT7U6DMBSGuXGvwQsx2Q9/6GWoWWKigmPIxzBrKVC+2tLXU9TpMmeUneTlEEifnk8vyVLcLpcI1xHCcI04TuAHzwhIUfQyfXN6eHzCinyWv6IQJY6Zd3F3jbOrc4RZhIIJcF5A0IGyLFFVFfkKdS2hlILWGkYbjON4HMgER9HU6JRGrwx6PU4azL60xZeIp0a702Dependu1wscHNP6YgB/lYi4C0C1iIsFZIOO8Xtz3L/VkLB5wM2HQFHSxFROoJSbNsOxpgpdEuRWPxD9HCF8NzhflBU8BB5niNNMzDGMMfsJ1BRoTnnkG2D8qMR1l15ClAIASmbqZtzYPtAqlvX9wSU04j8NhZ/jFBjQwPr/ClmvzfFbQKjOs5N9wDoujs31QPgQFvCGG0MNYaTr+t6NvANqsn4ijPQWyAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"issue image\"\n        title=\"issue image\"\n        src=\"/static/00e38d41c5d5b3c7ac1af83457b8da3a/f058b/issue.png\"\n        srcset=\"/static/00e38d41c5d5b3c7ac1af83457b8da3a/c26ae/issue.png 158w,\n/static/00e38d41c5d5b3c7ac1af83457b8da3a/6bdcf/issue.png 315w,\n/static/00e38d41c5d5b3c7ac1af83457b8da3a/f058b/issue.png 630w,\n/static/00e38d41c5d5b3c7ac1af83457b8da3a/40601/issue.png 945w,\n/static/00e38d41c5d5b3c7ac1af83457b8da3a/78612/issue.png 1260w,\n/static/00e38d41c5d5b3c7ac1af83457b8da3a/3707e/issue.png 1878w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<br/>\n<h2 id=\"api-docs-저장소-최신화\" style=\"position:relative;\">api-docs 저장소 최신화<a href=\"#api-docs-%EC%A0%80%EC%9E%A5%EC%86%8C-%EC%B5%9C%EC%8B%A0%ED%99%94\" aria-label=\"api docs 저장소 최신화 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>API 문서의 내용을 담은 이슈가 생성되었으니 이제 이 이슈의 내용으로 api-docs 저장소 내의 swagger.json 을 수정해 주어야 합니다.<br>\n해당 작업은 위와 동일한 이유로 python으로 구현하였습니다.</p>\n<h3 id=\"update_swaggerpy\" style=\"position:relative;\">update_swagger.py<a href=\"#update_swaggerpy\" aria-label=\"update_swaggerpy permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">import</span> time\n\n<span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"no system arguments\"</span><span class=\"token punctuation\">)</span>\n    exit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nGH_TOKEN <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\nGH_API_BASED_URL <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.github.com\"</span>\nGH_API_BASED_HEADERS <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bearer {}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>GH_TOKEN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"X-GitHub-Api-Version\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2022-11-28\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"Accept\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"application/vnd.github+json\"</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_recent_issue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 가장 최근에 생성된 issue 불러오기</span>\n    endpoint <span class=\"token operator\">=</span> GH_API_BASED_URL <span class=\"token operator\">+</span> <span class=\"token string\">\"/repos/grida-diary/api-docs/issues\"</span>\n    parameters <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"per_page\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"page\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span>\n    response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>\n        endpoint<span class=\"token punctuation\">,</span>\n        headers<span class=\"token operator\">=</span>GH_API_BASED_HEADERS<span class=\"token punctuation\">,</span>\n        params<span class=\"token operator\">=</span>parameters\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">]</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">write_swagger_json</span><span class=\"token punctuation\">(</span>issue_body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 이슈 내용을 읽은 후 meta-data와 통합하여 swagger.json 최신화</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./meta-data.json\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> meta<span class=\"token punctuation\">:</span>\n        meta_data <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span>meta<span class=\"token punctuation\">)</span>\n\n        json_data <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>issue_body<span class=\"token punctuation\">)</span>\n        json_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"info\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> meta_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"info\"</span><span class=\"token punctuation\">]</span>\n        json_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"info\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"description\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"last updated : \"</span> <span class=\"token operator\">+</span> time<span class=\"token punctuation\">.</span>strftime<span class=\"token punctuation\">(</span><span class=\"token string\">'%Y-%m-%d %H:%M:%S'</span><span class=\"token punctuation\">)</span>\n        json_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"servers\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> meta_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"servers\"</span><span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword\">if</span> meta_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"authorize\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"enable\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n            json_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"components\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"securitySchemes\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> meta_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"authorize\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"securitySchemes\"</span><span class=\"token punctuation\">]</span>\n            json_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"security\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> meta_data<span class=\"token punctuation\">[</span><span class=\"token string\">\"authorize\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"security\"</span><span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword\">if</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>isfile<span class=\"token punctuation\">(</span><span class=\"token string\">\"./swagger.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            os<span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span><span class=\"token string\">\"./swagger.json\"</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./swagger.json\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"w\"</span><span class=\"token punctuation\">,</span> encoding<span class=\"token operator\">=</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> swagger<span class=\"token punctuation\">:</span>\n            json<span class=\"token punctuation\">.</span>dump<span class=\"token punctuation\">(</span>json_data<span class=\"token punctuation\">,</span> swagger<span class=\"token punctuation\">,</span> ensure_ascii<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> indent<span class=\"token operator\">=</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span>\n\n\nissue <span class=\"token operator\">=</span> get_recent_issue<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nwrite_swagger_json<span class=\"token punctuation\">(</span>issue<span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<h3 id=\"update_api_docsyml\" style=\"position:relative;\">update_api_docs.yml<a href=\"#update_api_docsyml\" aria-label=\"update_api_docsyml permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>마지막 단계입니다.<br>\n동작할 스크립트도 구현되었으니 issue가 생성될 때 위 스크립트를 동작시켜 줄 github action을 작성해 줍니다.\n파이썬 스크립트를 통해 수정된 swagger.json의 내용을 원격 저장소로 commit-push 해주는 작업 또한 추가해 줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> update api docs\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">issues</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> opened <span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">permissions</span><span class=\"token punctuation\">:</span> write<span class=\"token punctuation\">-</span>all\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">update-readme</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up and Run script\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>python@v5\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">python-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.10\"</span>\n          <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'pip'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> pip install requests\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> python3 ./scripts/update_swagger.py $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GH_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Commit to repository\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          git config --global user.email \"username@naver.com\"\n          git config --global user.name \"username\"\n          git add .\n          git commit -m \"docs : update api docs\"\n          git push origin main</span></code></pre></div>\n<p>github-pages를 이용해 호스팅이 완료된 경우, 이 작업을 통해 swagger.json이 수정되는 순간 새로 페이지를 빌드하여 별도의 빌드 과정 없이 수정 내용을 반영할 수 있습니다.</p>\n<p>gh-pages 에서는 <a href=\"https://wwan13.github.io/api-docs\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://wwan13.github.io/api-docs</a> 와 같은 형태의 도메인을 제공하지만, 저는 <a href=\"https://docs.projectdomain.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://docs.projectdomain.com</a> 와 같이 서브 도메인을 이용하여 프로젝트 url의 통일성을 유지하고 있습니다.</p>","fields":{"slug":"/1008/"},"frontmatter":{"title":"API 문서 배포를 자동화 하기.","date":"2024-08-02T00:00:00.000Z","description":"Spring Rest Docs와 OAS3을 이용해 API 문서 배포 자동화 구축 과정을 공유해 보자.","tags":["Tech"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#a8d8f8","images":{"fallback":{"src":"/static/5f41d4f6bca2361e7c0ab05b9c49eaee/8058b/thumbnail.png","srcSet":"/static/5f41d4f6bca2361e7c0ab05b9c49eaee/52057/thumbnail.png 240w,\n/static/5f41d4f6bca2361e7c0ab05b9c49eaee/b380a/thumbnail.png 480w,\n/static/5f41d4f6bca2361e7c0ab05b9c49eaee/8058b/thumbnail.png 960w","sizes":"(min-width: 960px) 960px, 100vw"},"sources":[{"srcSet":"/static/5f41d4f6bca2361e7c0ab05b9c49eaee/226ed/thumbnail.webp 240w,\n/static/5f41d4f6bca2361e7c0ab05b9c49eaee/a1501/thumbnail.webp 480w,\n/static/5f41d4f6bca2361e7c0ab05b9c49eaee/55375/thumbnail.webp 960w","type":"image/webp","sizes":"(min-width: 960px) 960px, 100vw"}]},"width":960,"height":720}}}}},"previous":{"fields":{"slug":"/1007/"},"frontmatter":{"title":"어노테이션 기반 컨트롤러를 구현하는 방법."}},"next":{"fields":{"slug":"/1009/"},"frontmatter":{"title":"kotlin의 dsl로 spring rest docs를 개선하는 방법."}}},"pageContext":{"id":"5647f79b-95c6-5bc1-b0b2-da126dcac053","previousPostId":"e339ec8a-5e75-5027-b558-929360025c94","nextPostId":"a2dcd3bf-b39d-543e-94ab-8635543a4969"}},"staticQueryHashes":["2260143708","2538111481","658623446","984448874"],"slicesMap":{}}