{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/1006/","result":{"data":{"site":{"siteMetadata":{"title":"Wan.log","siteUrl":"https://wwan13.github.io","thumbnail":"/thumbnails/tech-blog-thumbnail.png"}},"markdownRemark":{"id":"5fd8da91-f0b7-5a05-a814-12a35a47fb3e","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%84%A4%EC%A0%95%EC%9D%98-%EC%B6%94%EC%83%81%ED%99%94\">설정의 추상화</a></p>\n<ul>\n<li><a href=\"#%EC%B2%AB-%EB%B2%88%EC%A7%B8-%EC%8B%9C%EB%8F%84\">첫 번째 시도</a></li>\n<li><a href=\"#%EB%91%90-%EB%B2%88%EC%A7%B8-%EC%8B%9C%EB%8F%84\">두 번째 시도</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#configurer-pattern\">Configurer Pattern</a></p>\n<ul>\n<li><a href=\"#%EB%82%98%EC%95%84%EA%B0%80\">나아가</a></li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></li>\n</ul>\n</li>\n</ul>","excerpt":"이 포스팅은 이전 포스팅과 동일한 예제를 사용합니다. Spring Security 없이 JWT 인증/인가 구현 해보기 spring filter를 interceptor로 바꿔보자 복잡한 Spring Configuration을 더욱 쉽게 관리 하는 법. (…","html":"<blockquote>\n<p>이 포스팅은 이전 포스팅과 동일한 예제를 사용합니다.</p>\n<ol>\n<li><a href=\"https://tech-blog.taewan.co.kr/1003/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Security 없이 JWT 인증/인가 구현 해보기</a></li>\n<li><a href=\"https://tech-blog.taewan.co.kr/1004/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">spring filter를 interceptor로 바꿔보자</a></li>\n<li><a href=\"https://tech-blog.taewan.co.kr/1005/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">복잡한 Spring Configuration을 더욱 쉽게 관리 하는 법. (1)</a></li>\n</ol>\n</blockquote>\n<br/>\n<p><a href=\"https://tech-blog.taewan.co.kr/1005/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">지난 포스팅</a>를 에서 Spring Auto Configure을 이용해 복잡한 설정을 어노테이션 하나로 해결해 보았습니다.</p>\n<br/>\n<p>하지만 AuthorizedRequest를 빈으로 등록해 주지 않으면 빈 사이의 의존 관계로 인해 <code class=\"language-text\">BeanCreationException</code>을 발생하고 스프링 어플리케이션을 실행할 수 없다는 문제가 발생합니다.</p>\n<p>Security 모듈의 구현을 맡은 개발자가 어플리케이션 모듈의 개발까지 맡는다면 아무 문제 없이 설정을 마칠 수 있을 것입니다.\n다만 다른 개발자가 어플리케이션 모듈의 개발을 해야 한다면 빈 사이의 의존관계를 파악하기 위해 모듈 내부의 구현 들여다볼 수밖에 없을 것입니다.</p>\n<p><br/><br/></p>\n<h2 id=\"설정의-추상화\" style=\"position:relative;\">설정의 추상화<a href=\"#%EC%84%A4%EC%A0%95%EC%9D%98-%EC%B6%94%EC%83%81%ED%99%94\" aria-label=\"설정의 추상화 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이 문제를 해결하려면 개발자에게 일종의 ’<strong>가이드</strong>‘를 제공해야 한다고 생각하였습니다.<br>\n저는 그 가이드의 한 종류로 <code class=\"language-text\">인터페이스</code>를 선택해 개발자로 하여금 구현을 강제시키고자 하였습니다.</p>\n<br/>\n<h3 id=\"첫-번째-시도\" style=\"position:relative;\">첫 번째 시도<a href=\"#%EC%B2%AB-%EB%B2%88%EC%A7%B8-%EC%8B%9C%EB%8F%84\" aria-label=\"첫 번째 시도 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">WebSecurityConfigurer</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">AuthorizedRequest</span> <span class=\"token function\">authorizedRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>처음으로 다음과 같은 방법으로 인터페이스를 제공하였습니다.\n위 인터페이스를 이용한 어플리케이션 모듈의 모습은 다음과 같았습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableWebSecurity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppSecurityConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebSecurityConfigurer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthorizedRequest</span> <span class=\"token function\">authorizedRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">AuthorizedRequestBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withPatterns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n            <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>  \n                    <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n                    <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/login\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup/email\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n                    <span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n            <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>  \n                    <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">GET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n                    <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/example\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n                    <span class=\"token function\">hasRoles</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ROLE_ADMIN</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ROLE_BASIC_USER</span><span class=\"token punctuation\">)</span>  \n            <span class=\"token punctuation\">)</span> \n            <span class=\"token punctuation\">.</span><span class=\"token function\">elseRequestAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>‘AuthorizedRequest를 반환하는 어떤 함수를 작성하라’라는 대략적인 가이드는 제공된 것 같습니다.</p>\n<p>하지만 ‘그걸 빈으로 등록해야 해’라는 추가적인 가이드는 제공되지 않는 모습입니다. 인터페이스를 구현하는 것 만으로 빈 등록까지 해주면 좋을 것 같다는 생각이 듭니다.</p>\n<br/>\n<h3 id=\"두-번째-시도\" style=\"position:relative;\">두 번째 시도<a href=\"#%EB%91%90-%EB%B2%88%EC%A7%B8-%EC%8B%9C%EB%8F%84\" aria-label=\"두 번째 시도 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>빈 등록까지 해준다면 좋겠다는 요구사항이 발생했으니, AuthorizedRequest를 빈으로 등록하고 그 빈을 Configurer로 넘겨 설정 정보를 받아야겠다는 생각을 하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthorizedRequestRegistrar</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthorizedRequest</span> <span class=\"token function\">authorizedRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">AuthorizedRequestBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withPatterns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">elseRequestPermit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">WebSecurityConfigurer</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">addPatterns</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthorizedRequest</span> authorizedRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableWebSecurity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppSecurityConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebSecurityConfigurer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addPatterns</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthorizedRequest</span> authorizedRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        authorizedRequest\n            <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>  \n                    <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n                    <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/login\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup/email\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n                    <span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n            <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>  \n                    <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">GET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n                    <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/example\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n                    <span class=\"token function\">hasRoles</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ROLE_ADMIN</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ROLE_BASIC_USER</span><span class=\"token punctuation\">)</span>  \n            <span class=\"token punctuation\">)</span> \n            <span class=\"token punctuation\">.</span><span class=\"token function\">elseRequestAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>어리석은 생각이었습니다.</p>\n<p>AuthorizedRequest를 빈으로 등록하는 데에는 성공하였지만, 등록된 빈에 설정 정보를 주입해주는 <code class=\"language-text\">WebSecurityConfigurer.addPatterns()</code>는 실행되지 않아 빈 설정 정보만 남아있었습니다.</p>\n<p><code class=\"language-text\">addPatterns()</code>는 <code class=\"language-text\">WebSecurityConfigurer</code>라는 @Configure 내부에 있지만 별도로 스프링 빈으로 등록하지 않았기 때문에 그 내부의 동작을 수행하지 않아 설정 정보가 전달되지 않았던 것입니다.</p>\n<p><br/><br/></p>\n<h2 id=\"configurer-pattern\" style=\"position:relative;\">Configurer Pattern<a href=\"#configurer-pattern\" aria-label=\"configurer pattern permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://tech-blog.taewan.co.kr/1005/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">지난 포스팅</a>의 인터셉터 등록 과정을 자세히 보면</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">InterceptorRegistrar</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addInterceptors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InterceptorRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ExampleInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">InterceptorRegistry</code>에 <code class=\"language-text\">addInterceptor()</code>에 인터셉터를 전달하는 것 만으로 빈과 InterceptorRegistrations에 등록되어 인터셉터로 동작할 수 있게 됩니다.</p>\n<br/>\n<p>어떤 키워드로 검색해야 할지 조차 모르겠던 와중 <code class=\"language-text\">Configurer Pattern</code>라는 키워드로 <a href=\"https://gist.github.com/keesun/1633571\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">백기선 님이 작성하신 코드</a>을 보게 되었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2d70139518dae17f243afde93dd0b882/4cdf7/configurer-pattern-ks.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.64556962025317%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVR42p2Uy27DIBBF/f+f2E03bZooBJvHwADGtzM4qiq1apwi3YUFDPfMw9PFzDgZj+vs4UJA5gKuDdwaSltFbf9+oCT3KDOmmApMqHg9E6znsdlEtVTwXW1dRf1PFbmjZqYmLrbeYc4W5w8LHwjFR2TvEGIEM2PbNhxZemyqElmP91oQnGBbhrURswtwnpBygT56OGAgxhILYq7D+tq/o6wDpUrARxrpUeRZXJzE1csp4mwW3OyM283CLh4XKw65QinKAylJoIRpFRddFKwbgW7GCLYVzD0Vz6w7coajCuL2hTwwDqL+gpxwmTNe3x3MHBHlAS2/HioHUH8ga+K1bVpiZCmQk0qnlAay6mnkUuv4WELBHBiU1CGP/lM9F3DbG1tXLxLQXOGt9qJ/2t2Xw5z3SVDR4pBiAqc2ivLPgEWSus/qCKwbd/u9H9c61DGZhfBmEj6M/ByWJPNL8tchRM2ltMIRsdRBz7sQZZabNnZHluqSzPAi03KV5iaifyBv+ARsXOgs/C8YPQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"출처 https://gist.github.com/keesun/1633571\"\n        title=\"출처 https://gist.github.com/keesun/1633571\"\n        src=\"/static/2d70139518dae17f243afde93dd0b882/f058b/configurer-pattern-ks.png\"\n        srcset=\"/static/2d70139518dae17f243afde93dd0b882/c26ae/configurer-pattern-ks.png 158w,\n/static/2d70139518dae17f243afde93dd0b882/6bdcf/configurer-pattern-ks.png 315w,\n/static/2d70139518dae17f243afde93dd0b882/f058b/configurer-pattern-ks.png 630w,\n/static/2d70139518dae17f243afde93dd0b882/40601/configurer-pattern-ks.png 945w,\n/static/2d70139518dae17f243afde93dd0b882/4cdf7/configurer-pattern-ks.png 995w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>사진은 위 코드를 발췌해 온 것으로 간단히 요약하면 다음과 같습니다.</p>\n<ol>\n<li><code class=\"language-text\">hello</code>라는 새 객체 생성</li>\n<li>NameConfigurer라는 인터페이스를 구현한 AppConfig의 <code class=\"language-text\">configure()</code> 실행</li>\n<li>실행 이후의 hello 객체를 반환하며 빈으로 등록</li>\n<li>빈으로 등록된 <code class=\"language-text\">hello</code>는 <code class=\"language-text\">configure()</code>에서 설정한 모든 정보를 갖고 있다</li>\n</ol>\n<br/>\n<p>‘모든 설정 정보를 가지는 빈을 자동으로 등록 해준다’라는 요구사항을 모두 충족시켜 줄 수 있기에 당장 위 예제를 적용해 보았습니다.</p>\n<p>(위 과정에서 AuthorizedRequest와 AuthorizedRequestBuilder에 약간의 리펙토링이 있었으나 위 코드에 대한 설명은 생략하겠습니다. <a href=\"https://github.com/grida-diary/grida-server/blob/main/grida-apis/apis-security/src/main/java/org/grida/authorizedrequest/AuthorizedRequest.java\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">코드 보기</a>)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthorizedRequestRegistrar</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">WebSecurityConfigurer</span> configurer<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthorizedRequestRegistrar</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSecurityConfigurer</span> configurer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>configurer <span class=\"token operator\">=</span> configurer<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthorizedRequest</span> <span class=\"token function\">authorizedRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">AuthorizedRequestFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token class-name\">AuthorizedRequestFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        configurer<span class=\"token punctuation\">.</span><span class=\"token function\">addPatterns</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">AuthorizedRequestApplier</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">WebSecurityConfigurer</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">addPatterns</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthorizedRequestFactory</span> factory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RUNTIME</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TYPE</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Import</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token class-name\">SecurityInterceptorRegistrar</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthorizedRequestRegistrar</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">EnableWebSecurity</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableWebSecurity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppSecurityConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebSecurityConfigurer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addPatterns</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthorizedRequestFactory</span> factory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        factory\n                <span class=\"token punctuation\">.</span><span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/login\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup/email\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">httpMethodPost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/role\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">httpMethodGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">elseRequestAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>AppSecurityConfig의 모습을 보면 제법 친절한 가이드를 재공 받은 것으로 보입니다.\n어떤 구현을 추가로 해야 하는지도 알려주고 있으며, 알아서 빈으로 등록도 해주고 있습니다.</p>\n<p>여전히 ’<code class=\"language-text\">@EnableWebSecurity</code>를 사용해야 한다는 것’, ’<code class=\"language-text\">WebSecurityConfigurer</code>의 구현을 해야 한다는 것’을 개발자가 알고 있어야 하긴 합니다.\n하지만 이제 영문도 모른 채 발생하는 빈 의존성 문제를 해결하기 위해 모듈 내부의 구현까지 뜯어볼 필요는 훨씬 줄어들었습니다.</p>\n<br/>\n<br/>\n<h3 id=\"나아가\" style=\"position:relative;\">나아가<a href=\"#%EB%82%98%EC%95%84%EA%B0%80\" aria-label=\"나아가 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@ConditionalOnBean</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token class-name\">WebSecurityConfigurer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthenticationInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">HandlerInterceptor</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@ConditionalOnBean</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token class-name\">WebSecurityConfigurer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DecodeTokenInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">HandlerInterceptor</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>각 인터셉터들에 <code class=\"language-text\">@ConditionalOnBean(value = {WebSecurityConfigurer.class})</code>이라는 어노테이션을 추가로 달아주었습니다.</p>\n<p>@ConditionalOnBean은 value로 전달되는 빈이 있는 경우에만 빈으로 생성한다는 의미로, WebSecurityConfigurer를 구현한 Configuration클래스가 없으면 위 인터셉터들을 빈으로 등록하지 않는다는 뜻입니다.</p>\n<p>따라서 Security 의존성을 갖고 있지만 @EnableWebSecurity와 WebSecurityConfigurer를 사용하지 않는 경우 불필요한 빈의 생성을 막아 리소스를 보다 효율적으로 사용할 수 있게 됩니다.</p>\n<p>또한 WebSecurityConfigurer에서 AuthorizedRequest를 생성하고, AuthenticationInterceptor는 AuthorizedRequest를 의존성으로 갖고 있기 때문에\n<code class=\"language-text\">BeanCreationException</code>을 방지할 수 있는 또 하나의 수단이 추가되었다고 할 수 있습니다.</p>\n<br/>\n<br/>\n<h3 id=\"마치며\" style=\"position:relative;\">마치며<a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><code class=\"language-text\">Congifurar Pattern</code> 이라 불리우는 이 패턴은 WebMvcConfigurar와 같이 스프링의 기본적인 설정을 하는 과정에서 많이 접할 수 있는 패턴입니다.</p>\n<p>이처럼 스프링이 개발자에게 보다 편한 개발 경험을 제공하기 다양한 패턴들을 공부하는 것도 큰 도움이 될 것이라고 느낄 수 있었습니다.</p>","fields":{"slug":"/1006/"},"frontmatter":{"title":"복잡한 Spring Configuration을 더욱 쉽게 관리하기. (2)","date":"2024-05-13T00:00:00.000Z","description":"Configurer Pattern을 이용해 설정을 보다 편하게 만들어보자.","tags":["Tech"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#b8c868","images":{"fallback":{"src":"/static/b730bc5ffb9d822968b39dbef0e10986/8058b/thumbnail.png","srcSet":"/static/b730bc5ffb9d822968b39dbef0e10986/52057/thumbnail.png 240w,\n/static/b730bc5ffb9d822968b39dbef0e10986/b380a/thumbnail.png 480w,\n/static/b730bc5ffb9d822968b39dbef0e10986/8058b/thumbnail.png 960w","sizes":"(min-width: 960px) 960px, 100vw"},"sources":[{"srcSet":"/static/b730bc5ffb9d822968b39dbef0e10986/226ed/thumbnail.webp 240w,\n/static/b730bc5ffb9d822968b39dbef0e10986/a1501/thumbnail.webp 480w,\n/static/b730bc5ffb9d822968b39dbef0e10986/55375/thumbnail.webp 960w","type":"image/webp","sizes":"(min-width: 960px) 960px, 100vw"}]},"width":960,"height":720}}}}},"previous":{"fields":{"slug":"/1005/"},"frontmatter":{"title":"복잡한 Spring Configuration을 더욱 쉽게 관리 하기. (1)"}},"next":{"fields":{"slug":"/1007/"},"frontmatter":{"title":"어노테이션 기반 컨트롤러를 구현하는 방법."}}},"pageContext":{"id":"5fd8da91-f0b7-5a05-a814-12a35a47fb3e","previousPostId":"1e797773-bf47-50cf-84c8-2851a914348d","nextPostId":"e339ec8a-5e75-5027-b558-929360025c94"}},"staticQueryHashes":["2260143708","2538111481","658623446","984448874"],"slicesMap":{}}