{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/1004/","result":{"data":{"site":{"siteMetadata":{"title":"Wan.log","siteUrl":"https://wwan13.github.io","thumbnail":"/thumbnails/tech-blog-thumbnail.png"}},"markdownRemark":{"id":"e246245a-f266-57b8-8148-0b1a768f3d4b","tableOfContents":"<ul>\n<li><a href=\"#%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EC%98%88%EC%99%B8%EB%A5%BC-%ED%95%B8%EB%93%A4%EB%A7%81%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%B4-%EC%B6%94%EA%B0%80%EC%A0%81%EC%9C%BC%EB%A1%9C-%EC%9A%94%EA%B5%AC%EB%90%98%EB%8A%94-filterexceptionhandler\">발생하는 예외를 핸들링하기 위해 추가적으로 요구되는 FilterExceptionHandler</a></li>\n<li><a href=\"#404-not-found%EB%A5%BC-%EB%B0%9C%EC%83%9D%ED%95%98%EC%A7%80-%EB%AA%BB%ED%95%98%EA%B3%A0-%ED%95%AD%EC%83%81-401-unauthorized%EB%A7%8C%EC%9D%84-%EB%B0%9C%EC%83%9D%EC%8B%9C%ED%82%B4\">404 Not Found를 발생하지 못하고 항상 401 Unauthorized만을 발생시킴</a></li>\n<li><a href=\"#spring-interceptor\">Spring Interceptor</a></li>\n<li><a href=\"#interceptor%EB%A1%9C-%EB%B3%80%EA%B2%BD\">Interceptor로 변경</a></li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></li>\n</ul>","excerpt":"이 포스팅의 예제는 Spring Security 없이 JWT 인증/인가 구현 해보기와 동일한 예제를 사용합니다. 지난번에 Spring Filter를 이용해 Spring Security…","html":"<blockquote>\n<p>이 포스팅의 예제는 <a href=\"https://tech-blog.taewan.co.kr/web-security-without-sprint-security/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Security 없이 JWT 인증/인가 구현 해보기</a>와 동일한 예제를 사용합니다.</p>\n</blockquote>\n<br/> \n<p>지난번에 Spring Filter를 이용해 Spring Security를 사용하지 않고 인증, 인가를 구현하였습니다.</p>\n<p>초기엔 큰 문제없이 사용하고 있었지만, 사용하며 발생한 몇 가지 문제점과 여전히 해결하지 못한 몇 가지 불편함을 느낄 수 있었습니다.</p>\n<p>문제점들은 다음과 같습니다.</p>\n<ol>\n<li>발생하는 예외를 핸들링하기 위해 추가적으로 요구되는 <code class=\"language-text\">FilterExceptionHandler</code></li>\n<li>404 Not Found 를 발생하지 못하고 항상 401 Unauthorized 만을 발생시킴</li>\n<li>여전히 복잡하고 귀찮은 설정</li>\n</ol>\n<p>본 포스팅에서는 3번 항목을 제외한 1,2번 항목을 해결한 과정을 다룰 에정입니다.</p>\n<br/> \n<br/> \n<h2 id=\"발생하는-예외를-핸들링하기-위해-추가적으로-요구되는-filterexceptionhandler\" style=\"position:relative;\">발생하는 예외를 핸들링하기 위해 추가적으로 요구되는 FilterExceptionHandler<a href=\"#%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EC%98%88%EC%99%B8%EB%A5%BC-%ED%95%B8%EB%93%A4%EB%A7%81%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%B4-%EC%B6%94%EA%B0%80%EC%A0%81%EC%9C%BC%EB%A1%9C-%EC%9A%94%EA%B5%AC%EB%90%98%EB%8A%94-filterexceptionhandler\" aria-label=\"발생하는 예외를 핸들링하기 위해 추가적으로 요구되는 filterexceptionhandler permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Spring Filter는 모든 요청을 전처리, 후처리 하는 데 있어 굉장히 유용하게 사용되지만, 한 가지 큰 단점이 존재하였습니다.\n바로 <code class=\"language-text\">@RestControllerAdvice</code> 와 <code class=\"language-text\">@ExceptionHandler</code>에 의한 <strong>예외 핸들링이 불가</strong>하다는 점입니다.</p>\n<p>그 원인은 Spring Filter가 요청을 처리하는 위치에 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a0cbad36a56eb1a6125b22407810daaa/21b4d/filter-interceptor.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhUlEQVR42n2Se2+bMBTF+f5fqtJUdelaWhiBhDx4+AEGYiA8GraknN2YPyZ10iz9dI5sc7DvtYUvQ+kekTojKTpDXJAvB3jHHA8rF4+2D2fHwesJaTXS3s5wJFjZwZrnmWLmv4E1bSo/kOoJyWkyoYrFKDnBIvjvL3j69gB79QT39RknmaISCSpa51kB658TNiMOqkfItdFUtegSD5MIMMkNRuZB72zovY1z5ODCfZpbY+IecilgOb6NQktcr1fMn5/I6MqhaBAkpdE4b6DCN0j/GfroYmABTvt36IODgW+Mlrs3nGOXAiWsDXulGvgoygJt02ATCTj7DKL5jYBpuNsUifsdqftoQrPgB6rQNoj1Cmr7gpp+1MU/l8CPXz3GS4/b7WZqmdcDQtnikLXYkSZ5izrycJFb9OkaIw9IfeMH5qMzSnOJtwR+rWFOTTkW98YQ1QUx1bCNl48HChvpmv3dE3d/DzOeyIRYurx0ehkFnTCmzqZlv0DPhgkFLv8PEzm40vgDWMRQ4d/UVKYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"출처 https://mangkyu.tistory.com/173\"\n        title=\"출처 https://mangkyu.tistory.com/173\"\n        src=\"/static/a0cbad36a56eb1a6125b22407810daaa/f058b/filter-interceptor.png\"\n        srcset=\"/static/a0cbad36a56eb1a6125b22407810daaa/c26ae/filter-interceptor.png 158w,\n/static/a0cbad36a56eb1a6125b22407810daaa/6bdcf/filter-interceptor.png 315w,\n/static/a0cbad36a56eb1a6125b22407810daaa/f058b/filter-interceptor.png 630w,\n/static/a0cbad36a56eb1a6125b22407810daaa/40601/filter-interceptor.png 945w,\n/static/a0cbad36a56eb1a6125b22407810daaa/78612/filter-interceptor.png 1260w,\n/static/a0cbad36a56eb1a6125b22407810daaa/21b4d/filter-interceptor.png 1280w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>위 사진에서 알 수 있듯 Filter는 Dispatcher Servlet으로 요청이 전달되기 <strong>전에</strong> 그 기능을 수행합니다. DispatcherServlet보다 앞 단에 위치하고 있기 때문에 이 Filter를 관리하는 곳도 Spring Context가 아니라 톰캣과 같은 Web Context가 되는 것이죠.</p>\n<p>문제는 Filter가 Spring Context에 의해 관리받지 않기 때문에 발생합니다. RestControllerAdvice는 Spring Context내부에서 발생하는 예외들에 대해서만 ExceptionHandler를 제공합니다. 따라서 Web Context에 의해 관리되는 Filter 내부 에서 발생하는 예외는 RestControllerAdvice에 의해 감지되지 못하는 것입니다.</p>\n<br/> \n<p>따라서 이전 포스팅에서는 다음과 같이 Filter들의 제일 앞단에 <code class=\"language-text\">FilterExceptionHandler</code>를 두어 별도로 예외를 처리하는 방법을 선택하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthFilterExceptionHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">OncePerRequestFilter</span> <span class=\"token punctuation\">{</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span>  \n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilterInternal</span><span class=\"token punctuation\">(</span>  \n            <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span>  \n            <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span>  \n            <span class=\"token class-name\">FilterChain</span> filterChain  \n    <span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>  \n            filterChain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ApisSecurityException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token class-name\">String</span> responseBody <span class=\"token operator\">=</span> <span class=\"token function\">createErrorResponse</span><span class=\"token punctuation\">(</span>exception<span class=\"token punctuation\">.</span><span class=\"token function\">getErrorCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n            <span class=\"token function\">sendErrorToClient</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">,</span> exception<span class=\"token punctuation\">.</span><span class=\"token function\">getErrorCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getHttpStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> responseBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   \n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createErrorResponse</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ErrorCode</span> errorCode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">ObjectMapper</span> objectMapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token class-name\">ApiResponse</span> errorResponse <span class=\"token operator\">=</span> <span class=\"token class-name\">ApiResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>errorCode<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ApiSecurityException\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token keyword\">return</span> objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>errorResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendErrorToClient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> status<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> responseBody<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">APPLICATION_JSON_VALUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setCharacterEncoding</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>  \n            response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>responseBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 필터가 추가된다는 것은 곧 애플리케이션 모듈에 등록해야 하는 작업이 하나 더 추가됨을 의미하기도 하였습니다.</p>\n<p><br/><br/></p>\n<h2 id=\"404-not-found를-발생하지-못하고-항상-401-unauthorized만을-발생시킴\" style=\"position:relative;\">404 Not Found를 발생하지 못하고 항상 401 Unauthorized만을 발생시킴<a href=\"#404-not-found%EB%A5%BC-%EB%B0%9C%EC%83%9D%ED%95%98%EC%A7%80-%EB%AA%BB%ED%95%98%EA%B3%A0-%ED%95%AD%EC%83%81-401-unauthorized%EB%A7%8C%EC%9D%84-%EB%B0%9C%EC%83%9D%EC%8B%9C%ED%82%B4\" aria-label=\"404 not found를 발생하지 못하고 항상 401 unauthorized만을 발생시킴 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>다음은 유효하지 않은 <code class=\"language-text\">/api/invalid/hahaha</code> 와 같이 유효하지 않은 요청에도 404가 아닌 401을 반환하는 문제가 발생하였습니다.</p>\n<p>이도 마찬가지로 Filter가 요청을 처리하는 위치 때문에 발생하는 문제였습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b43716af9c80645883b56ec836923a15/fbf08/spring-filter.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.44303797468356%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADi0lEQVR42nWUfU9bZRjG+VD+ocZP4R9+gyVjWdiWTTGAmojgBI0Rjcw4nYmLvAijgKwQXjZbKLT0jbbntIeWc3r6/t5CX6DQ9udTOjY25pM8uXOenPzOdd/PdZ2uVqtFtVqldnLCUa1OKWejWIqRj1o4rcQ5Pjklk06RzWbQNI1gMHi+E4kEqXSafD5Pm3GxutoP0WiEVDaHmi6SCt5BDRsJm7s5jP5DJH1IIKhwEI5gd3txuj3oeph8IU8unyMUCtFsNl4BO6XzhWazJSD9VIpmis5PCCtzOEMZDvQoakzUaJZIssBZo0VDvHt2dkY4rL9Q2Dqv58BWq0n7rNFoUtL7KRfM5Ox3qSVXOCq38AW87HpduP0eXLIbh8/FnjjTYxpKyE+tXnmp8g2FAhjp6wAdd6lEV1CybhY9g6wERpjeHGRK7GX5G5Z8wzzZ62NB+oJF/2dsqr9TPz25AHIJ2FHYbnnfN8kftnH8sW0yhaxQpeCU/aQLGeK5AwyBexj27zAv5j4tdRPJe64CDwWwIoB5Ry+af4pJ9084gqtshR5hDAwJtV+z4LzPU3mYv6UeZuRbPPHfYspzAz3nvNpyIdxHrWRCfjZAUJph1juOllQweEdZ9I6x4TIyszaBQ11HSVqRYhb8cSu24KIAul8HCiRBzwCHOROSACYP5nmmj7Hj2+Lxzigb0hKqVkXaT6IE80RiR1QqDY4roCd0AfRcVZjX+qkV2wr7SYQMrIV/xCpZ+Mv2PSvyY7zqHhbZjE3Zxh7cIVrwkytrYs7mqwpfzdBE1t5LQZ8TwDFsfgur+98xF7jJnO82s3s9/Gnq5rf1azxcu8aEXcxSuomWc7wdWBbAoutjNHmaWc+vxFIy88ojns58iGfkXTbuf8DaV++xOvw+1qF3MK5+xOR+D8mC8n/A9i3fIxFcYDeSZsK2zAPLLzw0fsnEZB/m5SHkf7/F+3wU6fkIVt/PBDImRD4uJUXUxiUf5gTwOLbEA2+W6+t2PjVa6TfJXN8KMS5FOzJaHSkXV9p6e5YHxAw3Kbh60QOzDJpVNhSNQCSBosdZD4T5wR46d0RbyLmsdo5fMLraAS+VilRrxxSrx+KWb5MWGU7v3CAmjP25SRPxCrEXjuPVExhkldHd0Gtmu7y66vW6+H1FyeYLJIplMolV4qmA8OAK5ZwwdCCOwaeyrcaxqDEMkorxIPGy5TeB/wF/AbIUQ2L+lwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"출처 https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/\"\n        title=\"출처 https://justforchangesake.wordpress.com/2014/05/07/spring-mvc-request-life-cycle/\"\n        src=\"/static/b43716af9c80645883b56ec836923a15/f058b/spring-filter.png\"\n        srcset=\"/static/b43716af9c80645883b56ec836923a15/c26ae/spring-filter.png 158w,\n/static/b43716af9c80645883b56ec836923a15/6bdcf/spring-filter.png 315w,\n/static/b43716af9c80645883b56ec836923a15/f058b/spring-filter.png 630w,\n/static/b43716af9c80645883b56ec836923a15/40601/spring-filter.png 945w,\n/static/b43716af9c80645883b56ec836923a15/fbf08/spring-filter.png 962w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>DispatcherServlet은 요청이 발생하면 발생한 요청의 uri과 등록된 컨트롤러들을 비교하여 적절한 컨트롤러를 매핑해주는 <code class=\"language-text\">HandlerMapping</code>을 제공합니다.<br>\n이때 적절한 컨트롤러를 찾을 수 없으면 <code class=\"language-text\">NoHandlerFoundException</code>즉 404 Not Found를 발생하게 됩니다.</p>\n<p>하지만 Filter는 DispatcherServlet의 앞단에서 동작하기 때문에 핸들러 매핑 여부와 관계 없이 모든 요청에 대해 필터 로직을 수행하게 됩니다.\n따라서 등록되지 않은 요청에 대해 401을 반환하는 <code class=\"language-text\">elseRequestAuthecticated</code>로 설정해두었을 때 <code class=\"language-text\">/api/invalid/hahaha</code>와 같이 유효하지 않은 url로 요청이 들어와도 등록되지 않는 url로 간주하여 401을 발생하는 것 이었습니다.</p>\n<br/>\n<br/>\n<h2 id=\"spring-interceptor\" style=\"position:relative;\">Spring Interceptor<a href=\"#spring-interceptor\" aria-label=\"spring interceptor permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이 두 가지 문제를 해결하려면 다음 조건을 모두 충족하는 무엇이 필요했습니다.</p>\n<ol>\n<li>Filter과 동일하게 요청 전처리가 가능해야 한다.</li>\n<li>Spring Context에 의해 관리되어야 한다.</li>\n<li>Dispatcher Servlet보다 뒷 단에서 로직을 수행할 수 있어야 한다.</li>\n</ol>\n<p>그리고 Spring Interceptor가 이 모든 조건을 충족한다는 것을 알 수 있었습니다.</p>\n<br/> \n<p>Spring Interceptor는 Spring에서 제공하는 인터페이스로 클라이언트의 요청을 가로채 <code class=\"language-text\">preHandle()</code>, <code class=\"language-text\">postHandle()</code>메서드를 통해 요청의 전처리, 후처리를 할 수 있도록 도와줍니다.</p>\n<p>Filter와 굉장히 유사한 기능을 수행하지만 Filter와 가장 큰 차이점은 <strong>Spring Context에 의해 관리</strong>되며, <strong>DispatcherServlet의 뒷 단</strong>에서 요청을 가로채 처리한다는 특징이 있습니다.</p>\n<br/> \n<p>이미 눈치 채신 분들도 있겠지만, 이러한 Spring Interceptor의 특징으로 인해 Filter를 Interceptor로 바꾸는 것 만으로 모든 문제를 해결할 수 있었습니다.</p>\n<br/>\n<ol>\n<li><strong>발생하는 예외를 핸들링하기 위해 추가적으로 요구되는 FilterExceptionHandler</strong>\n<ul>\n<li>Spring Interceptor는 Spring Context에 의해 관리받기 때문에 Interceptor 내부에서 발생하는 모든 예외는 RestControllerAdvice에 의해 핸들링됩니다.</li>\n<li>따라서 예외 처리를 위한 별도의 필터를 설정하지 않아도 RestControllerAdvice애 의해 모든 예외를 처리할 수 있게 됩니다.</li>\n</ul>\n</li>\n</ol>\n<br/> \n<ol>\n<li><strong>404 Not Found를 발생하지 못하고 항상 401 Unauthorized만을 발생시킴</strong>\n<ul>\n<li>Spring Interceptor는 DispatcherServlet의 뒷 단에서 요청을 처리하기 때문에 DispatcherServlet에서 HandlerMapping을 실패하는 경우 요청을 더 처리하지 않고 404 Not Found를 발생하게 됩니다.</li>\n<li>HandlerMapping에 성공한 요청만 Interceptor로 넘어오기 때문에 유효한 url들에 대해서만 전처리를 할 수 있어, 예측하지 못한 401 Unauthorized가 발생되는 문제를 해결할 수 있습니다.</li>\n</ul>\n</li>\n</ol>\n<br/>\n<br/>\n<h2 id=\"interceptor로-변경\" style=\"position:relative;\">Interceptor로 변경<a href=\"#interceptor%EB%A1%9C-%EB%B3%80%EA%B2%BD\" aria-label=\"interceptor로 변경 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이제 모든 Filter를 모두 Interceptor로 바꿔보도록 하겠습니다.<br>\nFilter를 사용한 기존 코드는 <a href=\"https://tech-blog.taewan.co.kr/web-security-without-sprint-security/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">여기</a>서 확인할 수 있습니다.</p>\n<br/>\n<p><strong>DecodeTokenInterceptor</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DecodeTokenInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">HandlerInterceptor</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/* constatnts */</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">TokenDecoder</span> tokenDecoder<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">TokenValidator</span> tokenValidator<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">preHandle</span><span class=\"token punctuation\">(</span>\n            <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">Object</span> handler\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">decodeToken</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ifPresent</span><span class=\"token punctuation\">(</span>tokenClaims <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            request<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">USER_EMAIL_ATTRIBUTE_KEY</span><span class=\"token punctuation\">,</span> tokenClaims<span class=\"token punctuation\">.</span><span class=\"token function\">userEmail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            request<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">USER_ROLE_ATTRIBUTE_KEY</span><span class=\"token punctuation\">,</span> tokenClaims<span class=\"token punctuation\">.</span><span class=\"token function\">role</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TokenClaims</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">decodeToken</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> bearerToken <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span><span class=\"token constant\">AUTHORIZATION_HEADER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">hasToken</span><span class=\"token punctuation\">(</span>bearerToken<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token function\">isValidTokenPrefix</span><span class=\"token punctuation\">(</span>bearerToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">String</span> token <span class=\"token operator\">=</span> bearerToken<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token constant\">AUTHENTICATION_TOKEN_START_INDEX</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        tokenValidator<span class=\"token punctuation\">.</span><span class=\"token function\">validateToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>tokenDecoder<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasToken</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> bearerToken<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>bearerToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isValidTokenPrefix</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> bearerToken<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> bearerToken<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token constant\">AUTHENTICATION_TOKEN_PREFIX</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<br/>\n<p><strong>AuthentocationInterceptor</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthenticationInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">HandlerInterceptor</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/* constatnts */</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AuthorizedRequest</span> authorizedRequest<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">preHandle</span><span class=\"token punctuation\">(</span>\n            <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">Object</span> handler\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> method <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> requestUri <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestURI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> role <span class=\"token operator\">=</span> <span class=\"token function\">readUserRole</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">validateUnauthorized</span><span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">,</span> requestUri<span class=\"token punctuation\">,</span> role<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">validateForbidden</span><span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">,</span> requestUri<span class=\"token punctuation\">,</span> role<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">readUserRole</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">USER_ROLE_ATTRIBUTE_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NullPointerException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token constant\">ANONYMOUS_ROLE</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">validateUnauthorized</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> method<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> requestUri<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> role<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">hasAuthentication</span><span class=\"token punctuation\">(</span>role<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token function\">canAccess</span><span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">,</span> requestUri<span class=\"token punctuation\">,</span> role<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApisSecurityException</span><span class=\"token punctuation\">(</span><span class=\"token constant\">HTTP_UNAUTHORIZED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">validateForbidden</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> method<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> requestUri<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> role<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">hasAuthentication</span><span class=\"token punctuation\">(</span>role<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token function\">canAccess</span><span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">,</span> requestUri<span class=\"token punctuation\">,</span> role<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApisSecurityException</span><span class=\"token punctuation\">(</span><span class=\"token constant\">HTTP_FORBIDDEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> role<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> role<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ANONYMOUS_ROLE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">canAccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> method<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> requestUri<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> role<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> authorizedRequest<span class=\"token punctuation\">.</span><span class=\"token function\">isAccessibleRequest</span><span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">,</span> requestUri<span class=\"token punctuation\">,</span> role<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p><strong>AppConfig</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityInterceptorRegistrar</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">DecodeTokenInterceptor</span> decodeTokenInterceptor<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AuthenticationInterceptor</span> authenticationInterceptor<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addInterceptors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InterceptorRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptor</span><span class=\"token punctuation\">(</span>decodeTokenInterceptor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptor</span><span class=\"token punctuation\">(</span>authenticationInterceptor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SsoAppSecurityConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthorizedRequest</span> <span class=\"token function\">authorizedRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">AuthorizedRequestBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withPatterns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token function\">allHttpMethods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/docs/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/login\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/api/auth/signup/email\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token function\">httpMethods</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">GET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">uriPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/auth/role\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">elseRequestAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><sup><em>* 설정을 두 개의 클래스로 분리해야 하는 이유는 별도의 포스팅을 통해 다뤄보겠습니다.</em></sup></p>\n<br/> \n<br/> \n<h2 id=\"마치며\" style=\"position:relative;\">마치며<a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>단순히 <code class=\"language-text\">Filter</code>를 <code class=\"language-text\">Interceptor</code>로 바꾸는 것으로 세 개의 문제 중 두 개의 문제를 해결할 수 있었습니다.\n문제를 해결하기 위해 새로운 것을 탐구하고 적용하는 것보다 기존에 사용하던 기술의 특징을 보다 깊이 이해하고 적용하는 것이 더욱 중요하다는 것을 느낀 경험이었습니다.</p>\n<p>하지만 여전히 두 개의 인터셉터를 등록해야 하는 과정이 좋은 경험으로 다가오진 않습니다.\n다음 포스팅에선 이 불편한 설정들을 조금이나마 간편하게 만들었던 경험을 공유해 보도록 하겠습니다.</p>","fields":{"slug":"/1004/"},"frontmatter":{"title":"spring filter를 interceptor로 바꿔보자","date":"2024-05-06T00:00:00.000Z","description":"spring filter를 사용하며 불편했던 점을 interceptor로 바꾸며 해결해 보자.","tags":["Tech"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#e89898","images":{"fallback":{"src":"/static/78aa2640141d1d7052d97d74e9cda979/8058b/thumbnail.png","srcSet":"/static/78aa2640141d1d7052d97d74e9cda979/52057/thumbnail.png 240w,\n/static/78aa2640141d1d7052d97d74e9cda979/b380a/thumbnail.png 480w,\n/static/78aa2640141d1d7052d97d74e9cda979/8058b/thumbnail.png 960w","sizes":"(min-width: 960px) 960px, 100vw"},"sources":[{"srcSet":"/static/78aa2640141d1d7052d97d74e9cda979/226ed/thumbnail.webp 240w,\n/static/78aa2640141d1d7052d97d74e9cda979/a1501/thumbnail.webp 480w,\n/static/78aa2640141d1d7052d97d74e9cda979/55375/thumbnail.webp 960w","type":"image/webp","sizes":"(min-width: 960px) 960px, 100vw"}]},"width":960,"height":720}}}}},"previous":{"fields":{"slug":"/1003/"},"frontmatter":{"title":"Spring Security 없이 JWT 인증/인가 구현 해보기"}},"next":{"fields":{"slug":"/1005/"},"frontmatter":{"title":"복잡한 Spring Configuration을 더욱 쉽게 관리 하는 법. (1)"}}},"pageContext":{"id":"e246245a-f266-57b8-8148-0b1a768f3d4b","previousPostId":"1ca6a5e1-d63b-583d-bfcb-aad0cbdff23b","nextPostId":"1e797773-bf47-50cf-84c8-2851a914348d"}},"staticQueryHashes":["2260143708","2538111481","658623446","984448874"],"slicesMap":{}}