{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/1009/","result":{"data":{"site":{"siteMetadata":{"title":"Wan.log","siteUrl":"https://wwan13.github.io","thumbnail":"/thumbnails/tech-blog-thumbnail.png"}},"markdownRemark":{"id":"a2dcd3bf-b39d-543e-94ab-8635543a4969","tableOfContents":"<ul>\n<li>\n<p><a href=\"#kotlin%EC%9D%98-dsl\">Kotlin의 Dsl</a></p>\n</li>\n<li>\n<p><a href=\"#kotlin-dsl-rest-docs\">Kotlin Dsl Rest Docs</a></p>\n<ul>\n<li><a href=\"#%EB%AC%B8%EC%84%9C-%EC%84%A0%EC%96%B8%EB%B6%80\">문서 선언부</a></li>\n<li><a href=\"#%EC%A4%91%EB%B3%B5-%EC%A0%9C%EA%B1%B0%EC%99%80-%EA%B5%AC%EC%A1%B0-%EB%B3%80%EA%B2%BD\">중복 제거와 구조 변경</a></li>\n<li><a href=\"#api%ED%98%B8%EC%B6%9C\">API호출</a></li>\n<li><a href=\"#%EB%AC%B8%EC%84%9C-%EC%83%9D%EC%84%B1\">문서 생성</a></li>\n<li><a href=\"#%ED%86%B5%ED%95%A9\">통합</a></li>\n</ul>\n</li>\n</ul>","excerpt":"Spring에서 제공하는 API 문서 제작 도구 를 사용하다 보면 여려분은 다음과 같은 코드를 많이 접하게 될 것입니다. 흔히 볼 수 있는 코드이기에 전혀 이상함을 느끼지 못하는 분들도 계실 것입니다. 하지만 위와 같은 방법으로 직접 API…","html":"<p>Spring에서 제공하는 API 문서 제작 도구 <code class=\"language-text\">Spring Rest Docs</code>를 사용하다 보면 여려분은 다음과 같은 코드를 많이 접하게 될 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Test</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">`회원가입 API`</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">val</span> request <span class=\"token operator\">=</span> <span class=\"token function\">SignInRequest</span><span class=\"token punctuation\">(</span>\n        username <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span><span class=\"token punctuation\">,</span>\n        password <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"raw password\"</span></span><span class=\"token punctuation\">,</span>\n        passwordConfirm <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"raw password\"</span></span><span class=\"token punctuation\">,</span>\n        nickname <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"nickname\"</span></span>\n    <span class=\"token punctuation\">)</span>\n\n    every <span class=\"token punctuation\">{</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">appendNormalUser</span><span class=\"token punctuation\">(</span><span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span> returns <span class=\"token number\">1L</span>\n    every <span class=\"token punctuation\">{</span> passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span> returns <span class=\"token string-literal singleline\"><span class=\"token string\">\"encoded password\"</span></span>\n\n    mockMvc\n        <span class=\"token punctuation\">.</span><span class=\"token function\">perform</span><span class=\"token punctuation\">(</span>\n            <span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"/api/v1/user\"</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">contentType</span><span class=\"token punctuation\">(</span>MediaType<span class=\"token punctuation\">.</span>APPLICATION_JSON<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span>MediaType<span class=\"token punctuation\">.</span>APPLICATION_JSON<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">characterEncoding</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"utf-8\"</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span>objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">andExpect</span><span class=\"token punctuation\">(</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>isOk<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">andDo</span><span class=\"token punctuation\">(</span>MockMvcResultHandlers<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">andDo</span><span class=\"token punctuation\">(</span>\n            <span class=\"token function\">document</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string-literal singleline\"><span class=\"token string\">\"sign-in\"</span></span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">resourceDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"회원가입 API 입니다.\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">tags</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"user\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                RestDocsUtils<span class=\"token punctuation\">.</span><span class=\"token function\">requestPreprocessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                RestDocsUtils<span class=\"token punctuation\">.</span><span class=\"token function\">responsePreprocessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                Function<span class=\"token punctuation\">.</span><span class=\"token function\">identity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">requestParameters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">pathParameters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">requestFields</span><span class=\"token punctuation\">(</span>\n                    <span class=\"token function\">fieldWithPath</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>JsonFieldType<span class=\"token punctuation\">.</span>STRING<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"유저 아이디\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n                    <span class=\"token function\">fieldWithPath</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"password\"</span></span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>JsonFieldType<span class=\"token punctuation\">.</span>STRING<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"유저 비밀번호\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n                    <span class=\"token function\">fieldWithPath</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"passwordConfirm\"</span></span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>JsonFieldType<span class=\"token punctuation\">.</span>STRING<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"비밀번호 확인\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n                    <span class=\"token function\">fieldWithPath</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"nickname\"</span></span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>JsonFieldType<span class=\"token punctuation\">.</span>STRING<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"닉네임\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">responseFields</span><span class=\"token punctuation\">(</span>\n                    <span class=\"token function\">fieldWithPath</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"status\"</span></span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>JsonFieldType<span class=\"token punctuation\">.</span>STRING<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"응답 상태\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token function\">fieldWithPath</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"timestamp\"</span></span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>JsonFieldType<span class=\"token punctuation\">.</span>STRING<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"응답 시간\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token function\">fieldWithPath</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"data.id\"</span></span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>JsonFieldType<span class=\"token punctuation\">.</span>NUMBER<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"생성된 user id\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>흔히 볼 수 있는 코드이기에 전혀 이상함을 느끼지 못하는 분들도 계실 것입니다.</p>\n<p>하지만 위와 같은 방법으로 직접 API 문서를 제작하다 보면 끊임없이 반복되는 복사 붙혀 넣기와,\n늘어나는 코드 라인에 API 문서 제작이 두려워지기도 하였습니다.</p>\n<p>이번 포스팅에서는 이런 부정적인 Spring Rest Docs의 문서 제작 경험을 다음과 같이 <code class=\"language-text\">Kotlin Dsl</code>을 이용해 더욱 긍정적으로 개선한 경험에 대해 공유해 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Test</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">`사용자 회원 가입 API`</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    every <span class=\"token punctuation\">{</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">appendNormalUser</span><span class=\"token punctuation\">(</span><span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span> returns <span class=\"token number\">1L</span>\n    every <span class=\"token punctuation\">{</span> passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span> returns <span class=\"token string-literal singleline\"><span class=\"token string\">\"encoded password\"</span></span>\n\n    <span class=\"token keyword\">val</span> api <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"/api/v1/user\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">requestBody</span><span class=\"token punctuation\">(</span>\n            <span class=\"token function\">SigninRequest</span><span class=\"token punctuation\">(</span>\n                username <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span><span class=\"token punctuation\">,</span>\n                password <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"raw password\"</span></span><span class=\"token punctuation\">,</span>\n                passwordConfirm <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"raw password\"</span></span><span class=\"token punctuation\">,</span>\n                nickname <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"nickname\"</span></span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">documentFor</span><span class=\"token punctuation\">(</span>api<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"user-sign-up\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">summary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"사용자 회원 가입 API\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">requestFields</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"유저가 사용하는 ID\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"password\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"비밀번호\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"passwordConfirm\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"비밀번호 확인\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"nickname\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"닉네임\"</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token function\">responseFields</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"data.id\"</span></span> isTypeOf NUMBER whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"생성된 유저의 ID\"</span></span>\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><br/><br/></p>\n<h2 id=\"kotlin의-dsl\" style=\"position:relative;\">Kotlin의 Dsl<a href=\"#kotlin%EC%9D%98-dsl\" aria-label=\"kotlin의 dsl permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><code class=\"language-text\">DSL</code>(Domain-Specific Language)은 ‘도메인 전용 언어’로<br>\n특정 비즈니스 도메인의 문제를 해결하려고 만든 작고 범용적이지 않은 특정 도메인을 대상으로 만든 특수 프로그래밍 언어입니다.</p>\n<p>그 대표적인 예시로는 SQL, Java의 stream api 등이 습니다.<br>\n코틀린에서는 mockk가 다음과 같이  dsl을 적극적으로 활용하고 있는 것을 볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">every <span class=\"token punctuation\">{</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">appendUser</span><span class=\"token punctuation\">(</span><span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span> returns <span class=\"token number\">1L</span></code></pre></div>\n<br/>\n<p>코틀린은 DSL을 구현하기 위해 <code class=\"language-text\">infix</code>라는 키워드를 제공하고 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">infix</span> <span class=\"token keyword\">fun</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeOf</span><span class=\"token punctuation\">(</span>type<span class=\"token operator\">:</span> FieldType<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> DocumentField <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">DocumentField</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>infix 함수는 위와 같이 선언할 수 있으며, 다음과 같은 방법으로 사용할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span> isTypeOf STRING</code></pre></div>\n<p>선언부의 infix를 제외하고 살펴보면 함수의 역할을 더욱 직관적으로 확인할 수 있으며, 아래와 동일한 역할을 수행합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">isTypeOf</span><span class=\"token punctuation\">(</span>STRING<span class=\"token punctuation\">)</span></code></pre></div>\n<p><br/><br/></p>\n<h2 id=\"kotlin-dsl-rest-docs\" style=\"position:relative;\">Kotlin Dsl Rest Docs<a href=\"#kotlin-dsl-rest-docs\" aria-label=\"kotlin dsl rest docs permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이제 이 infix 함수를 이용해 Sring Rest Docs를 개선해 보겠습니다.</p>\n<br/>\n<h3 id=\"문서-선언부\" style=\"position:relative;\">문서 선언부<a href=\"#%EB%AC%B8%EC%84%9C-%EC%84%A0%EC%96%B8%EB%B6%80\" aria-label=\"문서 선언부 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>가장 먼저 개선해야 할 부분은 이곳입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c4ef65b85f04d69c5a0e084aed351224/cab8c/DocumentField.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 131.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC5ElEQVR42p1V2XLaQBD0//+Wk9cEjNCtRbd2da0kdBrbnVnZpOxKbMAPXQgx9M5M98zeVbIF8yMkqUDdHNFPC7phRj9OmOZHjMsZC0b6PtDvX+FOBXX9tBL6UQYWpHAPKdK0hZQTynxALnoIfkRZ9nTQ/DXh+WGaT3A8H9rewl4LYWgpLEPANnOErEEcNJDNcDnD84nz4xPCJKHsfHgE3bLAwojeZYgzviITRB6nSDLxaaZ303JCRH/SdBu+L8AYRxgW8A8cTTcjlz3a47ASvMenGSpCdfp2pyNJalTlAFlPqKsRsp1QyAHH4U2gN1zsoQqqmw7OIUBI5TRdt6p8RkeETTcSetRtj+Y4XhalHxccWA7LjOlT4BDEsF0G3bRhk1gsTMFFCV5IVLK7THgk7/mOBLNrMDfDg6avhAc/hB9ESJUQqnRq0XiNbVTwznCwIdts9jo8IhnIzKcXYHl+wfT0jEH171ofquDQsLC7/4Ht/U/EmglhB4j2LqQfo6eSB1FQ3OkKQnUqlTKTxzqew9b2cDY2nC2D+ZvB3vrgToIxCNe4r7L8QNgTWel64JYDbjvIvQNyFkCGMUYy/cDFK+FVJb8hL2uaEhsuZWRZnFTO4HkFsqylcpfLo/fhBWWq/KjGK4ozGrESCSflIwFRNhfJ/iFUXuR5id3egGkEME1ln5gWBm0gl1PMfGOGBNkeEaec5psjJSOzKEciarTdQBN1c4YzbZQCpu3CcxN4rIBhUelJg7KgBXFLhopMLQH1rNZTmhUQeU3PEmXVoTvOt/VQEao1ZjneOnIZ9bKmMiVhWh6vIvtvD5UomwcNmuZB12MSKKYdWdA10H1HlBkpL7ClxaDvPZhWgl8PpDb1sar676ksyNh7w4ZhMio/ofJp/cc1XVjD90pWk6JUdt0YDpGp7AK/RpzIddleTagUfr0vFrJOuULQMk1FQ0u1RV61f11wkVDdy++D1ZWglD3jmrvkTPgHuNC9I897/msAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DocumentField\"\n        title=\"DocumentField\"\n        src=\"/static/c4ef65b85f04d69c5a0e084aed351224/f058b/DocumentField.png\"\n        srcset=\"/static/c4ef65b85f04d69c5a0e084aed351224/c26ae/DocumentField.png 158w,\n/static/c4ef65b85f04d69c5a0e084aed351224/6bdcf/DocumentField.png 315w,\n/static/c4ef65b85f04d69c5a0e084aed351224/f058b/DocumentField.png 630w,\n/static/c4ef65b85f04d69c5a0e084aed351224/cab8c/DocumentField.png 744w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>꽤나 직관적이고 이대로 사용해도 큰 문제없어 보입니다.<br>\n하지만 앞서 언급한 코틀린의 infix 함수를 사용해 더욱 직관적으로 바꿔보겠습니다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">DocumentField</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> identifier<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> type<span class=\"token operator\">:</span> FieldType<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">var</span> description<span class=\"token operator\">:</span> String <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">var</span> required<span class=\"token operator\">:</span> Boolean <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> enumValues<span class=\"token operator\">:</span> String <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"\"</span></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>먼저 Field 영역에 필요한 정보를 담은 data 클래스를 정의해 줍니다. 식별자, 타입, 설명, 필수 여부, enum의 경우 그 값 이 이에 해당합니다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">infix</span> <span class=\"token keyword\">fun</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeOf</span><span class=\"token punctuation\">(</span>type<span class=\"token operator\">:</span> FieldType<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> DocumentField <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">DocumentField</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">infix</span> <span class=\"token keyword\">fun</span> <span class=\"token operator\">&lt;</span>T <span class=\"token operator\">:</span> Enum<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token operator\">></span> String<span class=\"token punctuation\">.</span><span class=\"token function\">isTypeOf</span><span class=\"token punctuation\">(</span>enumType<span class=\"token operator\">:</span> ENUM<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> DocumentField <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">DocumentField</span><span class=\"token punctuation\">(</span>\n        identifier <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>\n        type <span class=\"token operator\">=</span> enumType<span class=\"token punctuation\">,</span>\n        enumValues <span class=\"token operator\">=</span> enumType<span class=\"token punctuation\">.</span>entries<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">infix</span> <span class=\"token keyword\">fun</span> DocumentField<span class=\"token punctuation\">.</span><span class=\"token function\">whichMeans</span><span class=\"token punctuation\">(</span>description<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> DocumentField <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">DocumentField</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>identifier<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">,</span> description<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">infix</span> <span class=\"token keyword\">fun</span> DocumentField<span class=\"token punctuation\">.</span><span class=\"token function\">required</span><span class=\"token punctuation\">(</span>required<span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> DocumentField <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">DocumentField</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>identifier<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">,</span> description<span class=\"token punctuation\">,</span> required<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>DocumentField 인스턴스를 생성할 수 있는 infix 함수를 정의해 줍니다.\n설명과 필수 유무는 반드시 들어가야 하는 값은 아니기 때문에 infix 함수를 한번 더 사용해 선택적으로 추가할 수 있도록 해줍니다.</p>\n<p>이제 다음과 같은 방법으로 DocumentField를 생성할 수 있습니다. 단순 영어 문장을 읽는 것처럼 편안하게 읽을 수 있게 되었습니다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span> isTypeOf STRING <span class=\"token comment\">// 이름, 타입만 존재하는 경우</span>\n<span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"사용자의 아이디\"</span></span> <span class=\"token comment\">// 이름, 타입, 설명이 존재하는 경우</span>\n<span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"사용자의 아이디\"</span></span> required <span class=\"token boolean\">true</span> <span class=\"token comment\">// 이름, 타입, 설명, 필수 유무가 모두 존재하는 경우</span></code></pre></div>\n<p>코드가 아닌 영어 문장을 읽는 것과 같은 느낌을 받을 수 있습니다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">toFieldDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> FieldDescriptor <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> descriptor <span class=\"token operator\">=</span> PayloadDocumentation<span class=\"token punctuation\">.</span><span class=\"token function\">fieldWithPath</span><span class=\"token punctuation\">(</span>identifier<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span>description <span class=\"token operator\">+</span> enumValues<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>required<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        descriptor<span class=\"token punctuation\">.</span><span class=\"token function\">optional</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> descriptor\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>내 마음대로 생성할 수 있게 되었으니, Spring Rest Docs가 필요로 하는 <code class=\"language-text\">FieldDescriptor</code>클래스로 변환해 주는 메서드를 작성해 줍니다.</p>\n<p>같은 방법으로 queryParameter, pathParameter, header를 생성할 수 있는 클래스도 만들어 주었습니다.</p>\n<p><br/><br/></p>\n<h3 id=\"중복-제거와-구조-변경\" style=\"position:relative;\">중복 제거와 구조 변경<a href=\"#%EC%A4%91%EB%B3%B5-%EC%A0%9C%EA%B1%B0%EC%99%80-%EA%B5%AC%EC%A1%B0-%EB%B3%80%EA%B2%BD\" aria-label=\"중복 제거와 구조 변경 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>다음 개선점은 중복과 구조 변경입니다.<br>\n기존에는 모든 API를 문서화할 때 마다 아래 사진의 빨간 네모 부분을 무조건 추가해야만 했습니다.</p>\n<p>또한 큰 불편함을 느끼진 않았지만, <code class=\"language-text\">mockMvc.perform(...).andDo(document(...))</code>와 같이 API호출 부분과 문서 작성 부분이 체이닝 되어 있어 이 두 부분을 분리하고자 하였습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a4de39628dfee9ae07fa4c72e5794732/cab8c/duplicate.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 131.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAADDElEQVR42p1V2ZbaRhSc//+oPDqZjQBCuwRC+4LU2iWY+JSr8dgZhyEe5qE4zUFU16269+quFA22XoAoyVB1A/rphHY6optmjKeXX3F8wTCf/gWf+y/uRv7QjjOifYD9/TN2CwXu4xrJ2kVt+zhoexSqh3yzQ2l4GPwQYxCdMQzTJeH5wJunuoWzWEIxHKjKHvomhqlnsIwC/q5GuG8g6vH7H09fMUYJhqa7UHrXU50knLsewdMTXIUKlyvojw/YKSoC3URkEoaJxHYQaAZiy8Ho+Rho0QXhRLKAt21UC57hY6duEVg+PN1DnQvkcYGmOGCo6jcQGNr+fQ8lYZikWCkaoligFBNEe0QlZojuiKKZGNCRofzzE4PEtVDkhwymalrYrgc/jFALgZ4W/EBLNbXoUNOzquFZlvoO2ZtQeFvdwfuygnWvwns2sFsqsB6fof95D/vpb3grDRn9S5MCJZ+9TihDYY/1hcD+D4VtE2K7MKF8+Qs2U9+tVexpR+K4GNwdprY7hziM/6eQJff9BOVpidXDAsuHR7i6gVHUeBlGHFn2REsGttY1Zb8SvsKPU6xZ1krVEcQ50rKDnwj6NjIYXnoliKuEM9Nr+xGWs4VlBrDtBLqRwDRTetewkuNthP0woyhrJNkBSV4g4zmvOCGN7Ln5t2QXhBL5oYJmWnDs6KxMo0LXLZB8RqFEReP9MEYQJtxAB0SpwDbIkB3q2xX2bIU0P0BhKIa+h0F1603IsYzhOOmHyr5QKDgNIdMOohQxvdwGOaKsQtMOnKibFc4MpIDBbeI6EdxtAd1k6VGNQyGX7w0KJVn3ujDl9o45Ylle8SxwKFu03Y0pS0K5xkzbPfdhQi8rlimI6Xj6ENm7HspQlusNNhsXmhYyIM42S8+z9jOhzIjTAquNBk11YZgRFmumTR/Lsv9cyhkbW9UtjtyW5UcsP0UYVhBi+PykyJQdJ4RNMqlu71UIIy7dcfo4oUxYBiOb+zzLRMYdGWc10qJBXjY/u+C3hC134duH5StBJvsD8vs4fyzpb6VLuMuNUOxdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"duplicate\"\n        title=\"duplicate\"\n        src=\"/static/a4de39628dfee9ae07fa4c72e5794732/f058b/duplicate.png\"\n        srcset=\"/static/a4de39628dfee9ae07fa4c72e5794732/c26ae/duplicate.png 158w,\n/static/a4de39628dfee9ae07fa4c72e5794732/6bdcf/duplicate.png 315w,\n/static/a4de39628dfee9ae07fa4c72e5794732/f058b/duplicate.png 630w,\n/static/a4de39628dfee9ae07fa4c72e5794732/cab8c/duplicate.png 744w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><br/><br/></p>\n<h3 id=\"api호출\" style=\"position:relative;\">API호출<a href=\"#api%ED%98%B8%EC%B6%9C\" aria-label=\"api호출 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>먼저 API호출 부분입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> <span class=\"token function\">MockMvcApiRequestBuilder</span><span class=\"token punctuation\">(</span>\n    method<span class=\"token operator\">:</span> HttpMethod<span class=\"token punctuation\">,</span>\n    path<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n    pathParameters<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span><span class=\"token keyword\">out</span> Any<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> ApiRequestBuilder <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> builder<span class=\"token operator\">:</span> MockHttpServletRequestBuilder\n\n    <span class=\"token keyword\">init</span> <span class=\"token punctuation\">{</span>\n        builder <span class=\"token operator\">=</span> <span class=\"token function\">httpMethodOf</span><span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> pathParameters<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">contentType</span><span class=\"token punctuation\">(</span>MediaType<span class=\"token punctuation\">.</span>APPLICATION_JSON<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span>MediaType<span class=\"token punctuation\">.</span>APPLICATION_JSON<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">characterEncoding</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"utf-8\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">requestHeader</span><span class=\"token punctuation\">(</span>\n        key<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n        value<span class=\"token operator\">:</span> String\n    <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ApiRequestBuilder <span class=\"token punctuation\">{</span>\n        builder<span class=\"token punctuation\">.</span><span class=\"token function\">header</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">queryParam</span><span class=\"token punctuation\">(</span>\n        key<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n        value<span class=\"token operator\">:</span> String\n    <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ApiRequestBuilder <span class=\"token punctuation\">{</span>\n        builder<span class=\"token punctuation\">.</span><span class=\"token function\">queryParam</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">requestBody</span><span class=\"token punctuation\">(</span>\n        body<span class=\"token operator\">:</span> Any\n    <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ApiRequestBuilder <span class=\"token punctuation\">{</span>\n        builder<span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span>JsonSerializer<span class=\"token punctuation\">.</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span>mockMvc<span class=\"token operator\">:</span> MockMvc<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ResultActions <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> mockMvc<span class=\"token punctuation\">.</span><span class=\"token function\">perform</span><span class=\"token punctuation\">(</span>builder<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">httpMethodOf</span><span class=\"token punctuation\">(</span>\n        method<span class=\"token operator\">:</span> HttpMethod<span class=\"token punctuation\">,</span>\n        path<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n        pathParameters<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span><span class=\"token keyword\">out</span> Any<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> MockHttpServletRequestBuilder <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span>method<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            GET <span class=\"token operator\">-></span> RestDocumentationRequestBuilders<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>pathParameters<span class=\"token punctuation\">)</span>\n            POST <span class=\"token operator\">-></span> RestDocumentationRequestBuilders<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>pathParameters<span class=\"token punctuation\">)</span>\n            PATCH <span class=\"token operator\">-></span> RestDocumentationRequestBuilders<span class=\"token punctuation\">.</span><span class=\"token function\">patch</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>pathParameters<span class=\"token punctuation\">)</span>\n            PUT <span class=\"token operator\">-></span> RestDocumentationRequestBuilders<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>pathParameters<span class=\"token punctuation\">)</span>\n            DELETE <span class=\"token operator\">-></span> RestDocumentationRequestBuilders<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>pathParameters<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>앞서 언급한 중복 코드 제거를 위해 Mockito가 제공하는 <code class=\"language-text\">MockHttpServletRequestBuilder</code>를\n<code class=\"language-text\">MockMvcApiRequestBuilder</code>로 감싸 초기화 블록에 중복 코드를 넣었습니다.</p>\n<p>또 이 단계에서 요청 객체를 직렬화해줌으로써 매번 <code class=\"language-text\">objectMapper.writeValueAsString()</code>를 호출해야 하는 번거로움을 없앨 수 있게 되었습니다.</p>\n<p><code class=\"language-text\">build()</code> 메서드를 통해 실행되며 <code class=\"language-text\">mockMvc.perform()</code>을 그대로 반환하기 때문에 이 메서드의 반환값을 체이닝 하여 문서 제작 로직을 수행할 수 있습니다.</p>\n<br/>\n<p>이 RequestBuilder는 아래 MethodSelector를 통해 <code class=\"language-text\">api.get()</code>과 같은 방법으로 호출할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> <span class=\"token function\">MockMvcApiMethodSelector</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> applyAction<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\n        requestBuilder<span class=\"token operator\">:</span> MockMvcApiRequestBuilder<span class=\"token punctuation\">,</span>\n        buildAction<span class=\"token operator\">:</span> ApiRequestBuilder<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Unit\n    <span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> ResultActions\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> ApiMethodSelector <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>\n        path<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">vararg</span> pathParameters<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span>\n        buildAction<span class=\"token operator\">:</span> ApiRequestBuilder<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Unit\n    <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ResultActions <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> requestBuilder <span class=\"token operator\">=</span> <span class=\"token function\">MockMvcApiRequestBuilder</span><span class=\"token punctuation\">(</span>GET<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> pathParameters<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">applyAction</span><span class=\"token punctuation\">(</span>requestBuilder<span class=\"token punctuation\">,</span> buildAction<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// post(), put(), patch(), delete() ...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><br/><br/></p>\n<h3 id=\"문서-생성\" style=\"position:relative;\">문서 생성<a href=\"#%EB%AC%B8%EC%84%9C-%EC%83%9D%EC%84%B1\" aria-label=\"문서 생성 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>문서 생성 부분도 동일하게 <code class=\"language-text\">MockMvcRestDocumentationWrapper.document()</code>를 <code class=\"language-text\">MockMvcApiDocumentGenerator</code>로 감싸는 것으로 중복을 제거하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> MockMvcApiDocumentGenerator <span class=\"token operator\">:</span> ApiDocumentGenerator <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">generate</span><span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> ApiDocumentContext<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ResultHandler <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> MockMvcRestDocumentationWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">document</span><span class=\"token punctuation\">(</span>\n            context<span class=\"token punctuation\">.</span>identifier<span class=\"token punctuation\">,</span>\n\n            context<span class=\"token punctuation\">.</span><span class=\"token function\">toResourceDetail</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n            DocumentUtil<span class=\"token punctuation\">.</span><span class=\"token function\">requestPreprocessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            DocumentUtil<span class=\"token punctuation\">.</span><span class=\"token function\">responsePreprocessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n            DocumentUtil<span class=\"token punctuation\">.</span><span class=\"token function\">snippetFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n            <span class=\"token operator\">*</span>context<span class=\"token punctuation\">.</span>snippets\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 context는 API 문서에 필요한 모든 구성요소의 집합으로 다음과 같이 구성되어 있으며, builder를 통해 생성됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">ApiDocumentContext</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> identifier<span class=\"token operator\">:</span> String1<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> summary<span class=\"token operator\">:</span> DocumentSummary<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> guide<span class=\"token operator\">:</span> DocumentGuide<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> enums<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>DocumentEnum<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> errors<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>DocumentError<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> pathParameters<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>DocumentCommonEntity<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> queryParameters<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>DocumentCommonEntity<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> requestHeaders<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>DocumentCommonEntity<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> requestFields<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>DocumentField<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> responseHeaders<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>DocumentCommonEntity<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> responseFields<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>DocumentField<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> commonResponseFields<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>DocumentField<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">val</span> snippets<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span>Snippet<span class=\"token operator\">></span>\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> snippets <span class=\"token operator\">=</span> mutableListOf<span class=\"token operator\">&lt;</span>Snippet<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pathParameters<span class=\"token punctuation\">.</span><span class=\"token function\">isNotEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> snippets<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token function\">toPathParameterSnippet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>queryParameters<span class=\"token punctuation\">.</span><span class=\"token function\">isNotEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> snippets<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token function\">toRequestParameterSnippet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">isNotEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> snippets<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token function\">toRequestHeaderSnippet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestFields<span class=\"token punctuation\">.</span><span class=\"token function\">isNotEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> snippets<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token function\">toRequestFieldSnippet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>responseHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">isNotEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> snippets<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token function\">toResponseHeaderSnippet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>allResponseFields<span class=\"token punctuation\">.</span><span class=\"token function\">isNotEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> snippets<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token function\">toResponseFieldSnippet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">return</span> snippets<span class=\"token punctuation\">.</span><span class=\"token function\">toTypedArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><br/><br/></p>\n<h3 id=\"통합\" style=\"position:relative;\">통합<a href=\"#%ED%86%B5%ED%95%A9\" aria-label=\"통합 permalink\" class=\"heading-anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>이렇게 구현한 클래스들은 <code class=\"language-text\">MockMvcApiDocsTest</code>라는 추상클래스를 통해 사용자에게 제공됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@TestConstructor</span><span class=\"token punctuation\">(</span>autowireMode <span class=\"token operator\">=</span> TestConstructor<span class=\"token punctuation\">.</span>AutowireMode<span class=\"token punctuation\">.</span>ALL<span class=\"token punctuation\">)</span>\n<span class=\"token annotation builtin\">@AutoConfigureRestDocs</span>\n<span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> MockMvcApiDocsTest <span class=\"token operator\">:</span> ApiDocsTest <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">val</span> api <span class=\"token operator\">=</span> MockMvcApiMethodSelector <span class=\"token punctuation\">{</span> requestBuilder<span class=\"token punctuation\">,</span> buildAction <span class=\"token operator\">-></span>\n        requestBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>buildAction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token function\">mockMvc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">documentFor</span><span class=\"token punctuation\">(</span>\n        resultAction<span class=\"token operator\">:</span> ResultActions<span class=\"token punctuation\">,</span>\n        identifier<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n        action<span class=\"token operator\">:</span> ApiDocumentContextBuilder<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Unit\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> builder <span class=\"token operator\">=</span> <span class=\"token function\">ApiDocumentContextBuilder</span><span class=\"token punctuation\">(</span>identifier<span class=\"token punctuation\">,</span> <span class=\"token function\">tag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">commonResponseField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> context <span class=\"token operator\">=</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> documentGenerator <span class=\"token operator\">=</span> <span class=\"token function\">MockMvcApiDocumentGenerator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        resultAction<span class=\"token punctuation\">.</span><span class=\"token function\">andDo</span><span class=\"token punctuation\">(</span>documentGenerator<span class=\"token punctuation\">.</span><span class=\"token function\">generate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">mockMvc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> MockMvc\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>사용자의 테스트 환경에 맞게 mockMvc를 구성할 수 있도록 추상 메서드로 제공하고 있습니댜.</p>\n<p><code class=\"language-text\">api</code>를 통해 API를 구성하고, 그 반환값을 <code class=\"language-text\">documentFor()</code>에 제공하는 것으로 API에 대한 문서를 작성하고 있습니다.</p>\n<br/>\n<p>이제 이 추상 클래스를 활용해 더욱 깔끔하고 직관적인 spring rest docs를 작성할 수 있게 되었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Test</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">`사용자 회원 가입 API`</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    every <span class=\"token punctuation\">{</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">appendNormalUser</span><span class=\"token punctuation\">(</span><span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span> returns <span class=\"token number\">1L</span>\n    every <span class=\"token punctuation\">{</span> passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span> returns <span class=\"token string-literal singleline\"><span class=\"token string\">\"encoded password\"</span></span>\n\n    <span class=\"token keyword\">val</span> api <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"/api/v1/user\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">requestBody</span><span class=\"token punctuation\">(</span>\n            <span class=\"token function\">SigninRequest</span><span class=\"token punctuation\">(</span>\n                username <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span><span class=\"token punctuation\">,</span>\n                password <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"raw password\"</span></span><span class=\"token punctuation\">,</span>\n                passwordConfirm <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"raw password\"</span></span><span class=\"token punctuation\">,</span>\n                nickname <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"nickname\"</span></span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">documentFor</span><span class=\"token punctuation\">(</span>api<span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"user-sign-up\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">summary</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"사용자 회원 가입 API\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">requestFields</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"username\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"유저가 사용하는 ID\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"password\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"비밀번호\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"passwordConfirm\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"비밀번호 확인\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"nickname\"</span></span> isTypeOf STRING whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"닉네임\"</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token function\">responseFields</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string-literal singleline\"><span class=\"token string\">\"data.id\"</span></span> isTypeOf NUMBER whichMeans <span class=\"token string-literal singleline\"><span class=\"token string\">\"생성된 유저의 ID\"</span></span>\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<hr>\n<p><code class=\"language-text\">kotlin-dsl-rest-docs</code>의 모든 코드는 <a href=\"https://github.com/wwan13/kotlin-dsl-rest-docs\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">깃허브 저장소</a>에서 확인할 수 있습니다.<br>\n<del>스타와, contribution은 언제나 환영입니다 ~!</del></p>\n<p><a href=\"https://github.com/Desk-Mood/deskmood-server/tree/main/deskmood-core/core-api/src/test/kotlin/org/deskmood/docs\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">deskmood 저장소</a>에서 제가  <code class=\"language-text\">kotlin-dsl-rest-docs</code>를 어떻게 활용하고 있는지 확인하실 수 있습니다.</p>","fields":{"slug":"/1009/"},"frontmatter":{"title":"kotlin의 dsl로 spring rest docs를 개선하는 방법.","date":"2024-09-22T00:00:00.000Z","description":"kotlin-dsl-rest-docs의 개발 이야기.","tags":["Tech"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#98d878","images":{"fallback":{"src":"/static/f64c8636ccbf2e605450410e394c63cd/8058b/thumbnail.png","srcSet":"/static/f64c8636ccbf2e605450410e394c63cd/52057/thumbnail.png 240w,\n/static/f64c8636ccbf2e605450410e394c63cd/b380a/thumbnail.png 480w,\n/static/f64c8636ccbf2e605450410e394c63cd/8058b/thumbnail.png 960w","sizes":"(min-width: 960px) 960px, 100vw"},"sources":[{"srcSet":"/static/f64c8636ccbf2e605450410e394c63cd/226ed/thumbnail.webp 240w,\n/static/f64c8636ccbf2e605450410e394c63cd/a1501/thumbnail.webp 480w,\n/static/f64c8636ccbf2e605450410e394c63cd/55375/thumbnail.webp 960w","type":"image/webp","sizes":"(min-width: 960px) 960px, 100vw"}]},"width":960,"height":720}}}}},"previous":{"fields":{"slug":"/1008/"},"frontmatter":{"title":"API 문서 배포를 자동화 하기."}},"next":{"fields":{"slug":"/1010/"},"frontmatter":{"title":"오류코드 문서화하기."}}},"pageContext":{"id":"a2dcd3bf-b39d-543e-94ab-8635543a4969","previousPostId":"5647f79b-95c6-5bc1-b0b2-da126dcac053","nextPostId":"b0575dd2-cdbb-50b2-a39c-b74eb97bc129"}},"staticQueryHashes":["2260143708","2538111481","658623446","984448874"],"slicesMap":{}}